ブラウザで遊べるターン制RPGゲームを作りたい。

- 言語は typescript
- ゲームのジャンルはターン制RPG
- タイトル名は "Eel Feed"
- 主人公はウナギのようなキャラクターのエルナルで、巨大なボス敵を倒しに行く目的がある
- ゲームの初期画面はタイトル画面と、注意書きテキスト、スタートボタンがある
- スタートを押すと、どのボスと戦うか選ぶ画面が出る。ボスのボタンを選択すると簡易的な説明が出て、OKボタンを押すとバトル開始
  - ボスはとりあえず、沼のドラゴン、闇のおばけ、機械のクモの3種類を用意
  - 内部的にはそれぞれのボスに対してHPや攻撃力などのパラメーター、行動パターンを設定できる
- バトルはターン制で、攻撃や防御、アイテム使用などの選択肢がある
- バトル中は、エルナルのHPやボスのHPが画面に表示される
- エルナルのステータス
  - HP: 1000
  - 攻撃力: 20
  - アイテム: 回復薬9個（HPを50%回復＋状態異常解除）、アドレナリン注射3個（次のターンまで無敵になる）
- エルナルができる行動
  - 攻撃（通常攻撃）
  - 防御（次のターンのダメージを半減）
  - アイテム使用（ターンを消費しない）
- ボスの行動の例
  - 単純にダメージを与える攻撃
  - 状態異常攻撃（火だるま、毒、鈍足、魅了など）
  - 拘束攻撃 (後術)
- ボスの拘束攻撃を受けると、「拘束状態」になり、解除されるまでエルナルは「もがく」か「じっとする」しかできない
  - もがくを選ぶと確率で拘束解除できる。失敗するほど確率が増加
  - じっとするを選ぶと、次のターンまで拘束が続くが、HPがすこし回復する
- ボスのHPが0になると勝利してバトル終了、ボス選択画面に戻る
- エルナルのHPが0になってもバトルは終了しないが、エルナルは5ターン行動できなくなる (5ターン後にHPが50%回復する)
- エルナルのHPが0になった状態でボスの拘束を受けていると、ボスに食べられてしまい（食べられ状態）、エルナルは「もがく」か「じっとする」しかできない
  - 拘束状態と同様だが、食べられ状態が解除される可能性は低い
- ボスに食べられ状態では、毎ターンボスがエルナルの最大HPを吸収し続ける
  - これによって最大HPが0以下になったら、エルナルはボスの体内に閉じ込められたという旨が表示されてゲームオーバーとなり、ボス選択画面に戻る

----

HTMLのスタイルには bootstrap を使用したいです。

ボス敵のデータは、今後簡単に増やせるように、ボス1体ごとに1ファイルにしたいです。

また、git関連のファイルのセットアップもお願いします(.gitignore, .gitattributes)。

----

各設定を記載した README.md の生成もお願いします。

----

状態異常に関する追記です。

・火だるま：2ターンの間、HPが毎ターン80減少します
・魅了：5ターンの間、「もがく」の成功率が低下します
・鈍足：2ターンの間、エルナルの攻撃力が半減します

ボスに食べられたときにボスが行ってくるHP九州は、ボスからの攻撃力に依存するものとします。

----

以下の修正を入れたいです。

- HPの数値の桁数を減らしたいので、現在設定されている全てのHPと攻撃力の値を 1/10 にしたい。
- その上で、エルナルの攻撃力を 5 に増加したい。
- エルナルが戦闘不能になった場合、「☠なすがまま」の行動ボタンを追加して、ターンをスキップできるようにしたい。拘束状態のコマンドでも同様に追加する。
- ボスの拘束攻撃から逃れた後の、ボスの気絶ターンが1ターンだけになっている。気絶したターンを含め、3ターン気絶した状態にしてほしい。

各修正が終わるごとにgitにコミットしてほしいです。コミット文の先頭には gitmoji による絵文字をつけてください。

git コミット文は日本語で記載してください。

----

- 状態変化の継続ターンが、想定より1ターン短くなっているようです。状態変化のターン数経過が行動開始前になっているかもしれませんので、行動開始後に状態変化のターン数を減らすように修正してください。また、状態変化による影響や、変化終了時のメッセージを出してください。
- エルナルの行動不能が終了したときのHP回復が動作していないようです。
- エルナルが行動不能になっている場合、行動選択画面は「☠なすがまま」だけの表示にしてください。

----

行動不能の解除がターン終了時に行うようにしたため、行動不能解除の回復が動作しなくなってしまうようです。以下のように修正したいです。

- 状態変化のターン消費と、状態変化によるダメージ処理、行動不能解除後のHP回復を、全体のラウンド終了時 (プレイヤーとボス両方の行動が終わった後) に行うように修正してください。

----

現状でも、エルナルの行動不能が終了したときのHP回復が動作していないようです。

----

- ボスの拘束攻撃と、食べる攻撃を明確に分離したいです。
- 拘束中にエルナルが行動不能になったら、ボスは高い確率で食べる攻撃の行動をさせたいです。
- 通常状態でエルナルが行動不能になったら、ボスは高い確率で拘束攻撃、または直接食べる攻撃をさせたいです。

1作業が終わったらコミットしてください。コミットメッセージや、コメントは日本語でお願いします。

----

以下の改良をしたい
コミットメッセージは1行にまとめてください。

- HPは「ヘルス」という名称にしたい
- エルナルやボスが与えるダメージにプラスマイナス20%のゆらぎを持たせたい
- 攻撃が5％の確率でミスになり、5％の確率で攻撃力3倍のクリティカルヒットになるようにしたい
  - エルナルが行動不能になっている間、ボスの攻撃はミスにならない
- 将来的に名前変更しやすいよう、主人公の「エルナル」の名前を変数にしたい
- 回復薬の回復量を、50％から80％に変更したい

----

以下の要素を追加したいです

- エルナルに「マナ(MP)」を追加し、初期値は40とする
- マナは毎ターンの開始時に、最大値の 1/4 回復する
- エルナルの行動に、マナを消費する行動 (スキル) を追加
  - パワーアタック (20MP消費、2.5倍の攻撃力で攻撃、ミスしない)
  - ヒール (30MP消費、HPを100回復)
  - あばれる (拘束状態でのみ使用可能。30MP消費、拘束から脱出する確率が2倍、失敗した場合は次以降に脱出できる確率が大きく増加)
- マナが足りない状態でスキルを使うと、スキルの効果が2倍になるが、「疲れ果て」状態になる
  - 疲れ果て状態ではスキルを使うことができない
  - 疲れ果て状態では攻撃力が半減して、受けるダメージが1.5倍になる
  - MPが最大まで回復しきるか、4ターン経過すると疲れ果て状態は解除される
- アイテムを追加:「元気ドリンク」
  - 3ターンの間、MPが常に満タンになる
  - 3個所持
- ボスに食べられている間は、MPが回復せず、ボスにMPを吸収され続ける
  - これによって疲れ果て状態になることはない

----

プレイヤーが行動した後、ステータス表示画面を更新してほしいです

----

攻撃 (行動) のパラメーターに以下を追加したい。

- 攻撃の成功率の上書き (デフォルトは現在と同じ 95%)
- 攻撃のクリティカル率の上書き (デフォルトは現在と同じ 5%)
- 状態異常を与えるとき、その状態異常の発生率の指定 (デフォルトは 100%)
- (ボス用) 行動条件に、エルナルが指定した状態（通常・HP0・拘束・食べられ状態）であることを条件に追加できる

そのうえで、ボスの行動を以下のように改良したい。
- 沼のドラゴン
  - 「クロー攻撃」修正：エルナルが通常状態のときのみ使用する
  - 「噛みつき」修正：攻撃力を15に上げる代わりに、成功率を70%にする。エルナルが通常状態のときのみ使用する。
  - 「尻尾しめつけ」を追加：拘束状態のときのみ使用する。ダメージは8で、成功率は100%。(クロー攻撃の代わり)
  - 「べろちゅー」を追加：拘束状態のときのみ使用する。ダメージは12で、成功率は100%。(噛みつき攻撃の代わり)
  - 「体内締め付け」「体内マッサージ」「お腹ゆらし」を追加：食べられ状態のときのみ使用する。元々ある「消化」のメッセージを変えるのみで、ダメージは変わらない。
- 闇のおばけ
  - 「影の爪」修正：エルナルが通常状態のときのみ使用する
  - 「なめまわし」を追加：拘束状態のときのみ使用する。

----

ボス行動で、拘束中のみに使える行動が、通常時でも使おうとしてしまうようです。また、食べられ中に使う行動が、元々ある行動上書きに書き換えられてしまうようです。

----

エルナルにアップグレードシステムを追加したいです。

- バトル開始前の画面にて、エルナルのステータスとアビリティレベルを表示
- エルナルはいくつかのアビリティを持っており、バトル中の行動によってアビリティ経験値を得る。一定経験値を得るとアビリティレベルが上がり、効果が強化される
- 各アビリティのレベルは初期状態は0で、最大10まで上げられる。必要な総獲得経験値は [次のアビリティレベル] ^ 3 * 100 で計算される
- アビリティは以下の通り
  - コンバット
    - 1レベルごとに攻撃力が 2% 上昇 (レベル/50を掛け算。小数点はゆらぎなどを計算した後の最終ダメージ計算時に四捨五入)
    - 与えたダメージ 1 ごとに 1 経験値を得る
    - レベルが上がるとエルナルが装備できる武器を解禁する (バトル開始前の画面で装備を選択できる)
      - レベル 0: 素手 (攻撃力 5)
      - レベル 1: パチンコ (攻撃力 6)
      - レベル 2: 木の弓矢 (攻撃力 8)
      - レベル 4: コンパウンドボウ (攻撃力 10)
      - レベル 6: サブマシンガン (攻撃力 15)
      - レベル 8: レーザーライフル (攻撃力 20)
      - レベル 10: スーパーブラスター (攻撃力 30)
  - タフネス
    - 1レベルごとに最大ヘルスが 10% 上昇 (レベル/10を掛け算。四捨五入)
    - 受けたダメージ 1 ごとに 1 経験値を得る。
    - HP0になり戦闘不能になるとき、 50 経験値を得る。
    - レベルが上がるとエルナルが装備できる防具を解禁する (バトル開始前の画面で装備を選択できる)
      - レベル 0: はだか (+0 HP)
      - レベル 1: Tシャツ (+10 HP)
      - レベル 2: 旅装 (+20 HP)
      - レベル 4: 冒険者の服 (+50 HP)
      - レベル 6: 軍用ジャケット (+100 HP)
      - レベル 8: 近未来スーツ (+200 HP)
      - レベル 10: 超合金アーマー (+500 HP)
  - クラフトワーク
    - 1レベルごとにアイテムによるHP回復の効果が 10% 上昇 (レベル/10を掛け算。小数点は四捨五入)
    - レベルが上がることによって新しいアイテムが解禁されたり、所持数が増加したりする
      - レベル 0: 回復薬 (5個、以降１レベルごとに所持数+1)
      - レベル 1: 元気ドリンク (1個)
      - レベル 2: 手投げ爆弾 (1個。ターン消費せずにボスに攻撃力 50 のダメージを与える)
      - レベル 3: 元気ドリンク所持数 +1 (合計2個)
      - レベル 4: アドレナリン注射 (1個)
      - レベル 5: 元気ドリンク所持数 +1 (合計3個)
      - レベル 6: 手投げ爆弾所持数 +1 (合計2個)
      - レベル 7: エリクサー (1個。HPを100%回復し、状態異常を解除、元気ドリンクの効果を得る)
      - レベル 8: アドレナリン注射所持数 +1 (合計2個)
      - レベル 9: アドレナリン注射所持数 +1 (合計3個)
      - レベル 10: おまもり (1個。行動不能状態・拘束中・食べられ中にのみ使える。即座にそれらの状態を解除し、HPを100%回復し、状態異常を解除)
    - アイテムを使用するたびに 50 経験値を得る。(高レベルのアイテムは得られる経験値が増える)
  - エンデュランス
    - 1 レベルごとに MP の最大値が 10% 上昇 (レベル/10を掛け算。小数点は四捨五入)
    - MP 1 消費ごとに 3 経験値を得る。「疲れ果て」になると 50 経験値を得る。
  - 今後アビリティは増やす予定。内容は深く決まっていない (スキルを解禁する「マジック」や、拘束抜け出し率を上げる「アジリティ」など)
- これらのアップグレードシステムに対応するため、各ボスのヘルスと攻撃力を2倍にしたいです。

最初の画面は以下のようにしたいです。

- 現在のエルナルステータス表示: 詳細表示ボタンで詳細ステータス・装備切り替え画面へ
- ボス選択画面: 現在と同じようにボスのステータスと挑むボタンを表示

エルナルのレベルアップ処理とUI表示をバトル終了時に実施したいです。
また、このときに LocalStorage にエルナルのレベルや経験値を保存して、次回のゲーム開始時に読み込めるようにしたいです。

装備切り替え機能で装備を切り替えた場合、装備の変更を LocalStorage に保存して、次回のゲーム開始時に読み込めるようにしたいです。

----

- ボスにダメージを与えても、コンバットに経験値が入らないときがあるようです。
- バトル中に左下のボタンで中断したときも、レベルや経験値に変動があれば結果画面を表示したいです。
- バトルの勝敗が決まった時、画面が自動で遷移するのではなく、行動メニューに「バトル終了」ボタンを出し、
  それを押すことで結果画面に遷移するようにしたいです。

修正した作業ごとに git にコミットしてください。

修正1についてですが、経験値はバトル終了画面に遷移したときに反映させるようにしたいです。なお、ダメージを受けたときのタフネス経験値は現在即座に反映されているようです。


----

- 初期MPを40から50に変更したいです。
- 毎ターンのMPの回復量を、最大値の1/4から1/5に変更したいです。
- アドレナリンの効果時間を1ターンから3ターンにしたいです。
- アドレナリンの効果が「ダメージが0になる」になっていますが、「ボスの攻撃を全て回避する (ミス扱い)」に変更したいです。
- エルナルのHPが0になったときに「エルナルはダウンしてしまった！」というメッセージを出したいです。

修正した作業ごとに git にコミットしてください。

----

- 未解禁のアイテムは、アイテム選択画面に表示しないようにしてください。
- スキルやアイテムの選択画面で、項目の簡単な説明を表示したいです。

修正した作業ごとに git にコミットしてください。

----

- 沼のドラゴンの「べろちゅー」、闇のおばけの「なめあわし」でダメージを与えたとき、ボスのHPをその分だけ回復させたいです。
- 食べられ時の最大HP吸収時、ボスのHPや最大HPもその分上がるようにしたいです（その戦闘中だけ有効）

将来的な拡張を踏まえて、与えたダメージに対するHP吸収量を指定できるようにしたいです。(デフォルトは0.0(無効)、1.0でダメージと同じ量回復)

----

- 攻撃時のダメージのゆらぎを、±20％をデフォルトとして、行動ごとに設定できるようにしたい。
  - スキルの「パワーアタック」は-20%～+50%のゆらぎ
  - 沼のドラゴンの噛みつきは-50％～+50％のゆらぎ
- 食べられ中のボスのHP吸収攻撃にも、他の攻撃と同じようにダメージのゆらぎを設定できるようにしたい。

----

「エルナルのステータス」「ボスのステータス」「バトルログ」「行動選択」の色が濃すぎて、文字が背景に埋もれてしまうので直したい。bootstrapのカラーテーマをそのまま使うより、自前のカラー定義で表示させたい。

また、CSSが黒ベースなのに対して、bootstrapのテーマカラーがライトのままになっているように思われるので、ダークテーマのbootstrapに固定させたい。

----

まず先に、バトルログの表示を改良したい。

- バトルログにて、誰の行動によるものかわかりやすくするようにしたい。
  - エルナルの行動は右にマージンをつけてウィンドウが左に寄るようし、ボスの行動は左にマージンをつけてウィンドウが右に寄るようにする
- 一部ボス行動に特殊なダイアログを表示させたい
  - 特に拘束攻撃や、拘束中・食べられ中攻撃に対して付けたい
  - 例：「沼のドラゴンは尻尾を巻き付けてきた！」「闇のおばけはエルナルの体を舐め回してきた！」など
  
次の作業で、ボスに食べられている状態で、エルナルの最大 HP が 0 以下になると即座にゲームオーバーになるが、これを少し変更したい。

- エルナルの最大 HP が 0 以下になるとすぐにゲームオーバーになるのではなく「再起不能」状態になり、詰みであることを示す
  - エルナルは「☠なすがまま」の行動しかできない (バトル終了まで自動的にターンが進む)
- 「再起不能」状態のエルナルに対してボスがトドメの攻撃を行ってから、ゲームオーバーにする
  - トドメの攻撃は「再起不能」状態のエルナルに対してのみ行う、実質的なゲームオーバーシーケンス
  - その内容は各ボスを深堀りするときに改めて決めたいので、一旦は仕組みだけ用意したい
  - トドメの攻撃が複数の連続的な行動で構成できるようにしたい。その場合、最後の行動を終えた後にゲームオーバーにする。
  - 特殊なダイアログを出せるようにしたい

作業ごとに git に日本語でコミットしてください。複数行にわたるコミットメッセージは、1行目に要約を記載し、2行目以降に詳細を記載してください。また、シングルクォーテーションで囲むようにしてください。

----

沼のドラゴンをより個性的なボスにしたい。

- 食べられ中の攻撃の1つ「消化」を「胃液分泌」にする
  - メッセージは「沼のドラゴンの胃袋が<PLAYER_NANE>をネバネバな胃液まみれにする...」
  - 他の行動となり、エルナルを3ターン「粘液まみれ」にする
    - 拘束状態の解除確率が半減する
- エルナルが「再起不能」になったときの行動を定義
  - 「沼のドラゴンは力尽きた<PLAYER_NAME>を体内の奥深くに送り込む！」
  - 「<PLAYER_NAME>は体内に閉じ込められ、沼のドラゴンが満足するまで消化され続けることになった...」
  - 以上のメッセージが出てゲームオーバーになる

作業ごとに git に日本語でコミットしてください。

----

戦闘終了後、エルナルの最大HPや状態異常が戻らないまま次のバトルに進んでしまうことがある。
戦闘終了時にこれらのステータスをリセットするようにしたい。

----

ボスの機械グモをより個性的なボスにしたい。

- 設定は「眼の前の生き物をなんでも壊れた機械と見なして修理しようとする機械クモ」
  - エルナルを「壊れた機械」と見なして、拘束して修理しようとする
  - エルナルを動けなくした後、繭に閉じ込めて縮小液で体を小さくしてから、体内修理装置で「修理」しようとする (でもエルナルは機械ではないので意味のない修理をされ続けることになる)
- ボスの行動
  - 「レーザーショット」通常時のみ使用。通常攻撃
  - 「クモキック」通常時のみ使用。ダメージが大きいが、成功率が低い攻撃
  - 「ショックバイト」通常時・対象ダウン中に使用、対象に噛みついて電気ショックを与える
    - 成功率が低い、当たると時々1ターンスタンさせる
  - 「スパイダーグラブ」通常時・対象ダウン中に使用、対象を抱きしめるように拘束する攻撃
    - 通常ダメージ、時々拘束状態にする
  - 「スパイダーネット」通常時・対象ダウン中に使用、機械の合成糸で作った網で対象を拘束する
    - ダメージはないが、高い確率で拘束状態にする
- エルナルが行動不能になり、拘束状態になったときに「縮小プロセス」を使用
  - エルナルを合成糸でぐるぐる巻きにして繭にし、内部を縮小液で満たす攻撃
  - 特別な拘束状態「繭状態」にする。
  - 拘束状態時と同じように、もがく、じっとするなどができ、拘束解除時に機械グモが行動不能になる
  - 繭状態時のクモの行動によって、エルナルの最大HPが減少する (エルナルの体が縮小されていることを表現)
    - 「繭の抱擁」: (通常行動)繭状態のエルナルをゆらゆら揺らし、最大HPを減らす
    - 「繭の圧縮」: 繭状態のエルナルを抱きしめて縮小液を馴染ませ、最大HPを多めに減らす
    - 「縮小液循環」：繭内部の縮小液を循環させることでエルナルのエネルギーを得る。最大HPを減らし、その2倍の量だけHPと最大HPを増やす。
  - 再起不能時の行動
    - 再起不能になった瞬間のメッセージ
      - 「エルナルは繭の中で完全に小さくなってしまった」
    - 機械グモが連続的に順番に以下の行動をする
      - 「機械グモは繭に噛みつき、中身をエルナルごと吸い上げる！」→エルナルが「食べられ」状態になる
      - 「機械グモは体内のエルナルを合成糸で体を拘束し、体内修理装置に縛りつける！」
      - 「修理装置に縛り付けられたエルナルは、機械グモが満足するまで意味のない修理をされ続ける....」→ゲームオーバー

作業ごとに git に日本語でコミットしてください。

----

github pages で公開するための設定を追加したいです。
その他、検索エンジンにインデックスされないように、METAタグと robots.txt を追加したいです。

ボス追加ドキュメントに以下の内容を追加で入れておきたい

- フレーバー設定などの注意点
  - エルナルに対する直接的で致命的な表現は控えるようにする (バラバラにしたり、死亡させたりはしない)

----

Player と Boss の共通処理部分をまとめた基底クラス Actor を作りたい。

- 共通化したい値
  - 表示名
  - HP
  - MP
  - ステータス値
    - 最大HP
    - 最大MP
    - 攻撃力
    - 防御力 (現在は0扱い)
- 共通化したい処理
  - ステータス値の再計算 ( `recalculateStats` )
    - Player はアビリティなどによるステータス再計算
    - Boss は識別IDからデータ参照によるステータス設定
  - 戦闘ステータスクリア処理 ( `resetBattleState` )
  - ダメージ処理 ( `takeDamage` )
    - HP の減少とダウン (KonckedOut) 処理
  - 回復処理 ( `heal` )
  - MP回復・消費処理
  - 戦闘ターン開始 ( `startTurn()` ) ・終了処理
  - 戦闘ラウンド終了処理 ( `processRoundEnd()` )

以上の計画で良さそうなので実装を進めよう

----

状態異常のコードが長くなってきたので整理したい。

- `configs` の記述が非常に長くなってしまったので、状態異常1つごとに情報を纏められるようにしたい。必要に応じてファイル分割を検討。
- `isXXX()` をステートごとに記載すると冗長なので、重要なステータスの `Dead` `Doomed` `KonckedOut` `Exhausted` `Restrained` `Eaten` 以外は、 `hasEffect` 関数で取得させるようにしたい。

----

沼のドラゴンのパーソナリティを考えてゲームに反映させたい。

- エルナルとくらべて3-4倍大きい、焦げ茶色のドラゴン
- カタコトで喋ることがあるが、基本的に言葉は少なく、それ以外は鳴き声や唸り声などを発する
- 狩猟など野性的な生活をしているが、文明のある生命体に対しては紳士で冷静な性格を見せる

----

エルナルが負けてしまった後 (ボスのとどめ行動をした後) も 「☠なすがまま」 でターンを進められるようにしたい。

- エルナルが食べられ、負けてしまった後の末路を観察しつづけられるというもの
- `isDead` とあるがシステム便宜上のもので、実際に死んだわけではないので注意
- 「☠なすがまま」の行動メッセージは「......」になる
- 各ボスはエルナルが負けてしまった (isDead = true) 後の特殊行動を BossAction で定義できる。4-5パターンあると良い
  - 各ボスの行動イメージ
    - 沼のドラゴン: 深い体内で体力を吸われ続けたり、消化活動を受け続ける
    - 闇のおばけ: 魂だけになったエルナルからエネルギーを吸い続ける
    - 機械グモ: 体内の修理装置に縛り付けたエルナルに対して栄養剤を注入したり、マッサージをしたり、無意味な修理をしたりする
    - 夢魔ちゃん: 夢の中で丸呑みしてとろとろになったエルナルを愛でつづける
  - これらの行動でエルナルの HP や MP は変動しないが、状態異常は与えても良い

----

新しいボス「砂漠のヘビ」を実装したい。

- 設定は「砂漠に生息する巨大なヘビ」
- 砂漠で彷徨った生命体を何でも飲み込んで、消化しながら遠くに連れ去ってしまう
- エルナルが拘束状態のとき、拘束中が3ターン続くと、エルナルがまだ倒れてなくても丸呑みしてくる
- 丸呑みされた後は、ヘビの体内に閉じ込められ、ヘビの消化液に浸される
  - 毎ターンの最大HP吸収は他のボスに比べ少ない
- その他ヘビっぽい能力があれば

実装できたらPR作って

----

新しいボス「運び屋のサソリ」を実装したい。

- 設定は「砂漠や荒れ地を漂う巨大なサソリ」
  - 見た目の特徴は、足がタイヤになっていて、巨大な注射器のような尻尾を持つ、半機械のような見た目をしている
  - さまよう人間を様々な方法で捕まえては丸呑みし、その者が望む (と勝手に考える) 場所へと運ぶ
  - 尻尾の注射器は色々な薬剤を注入するためのもので、麻酔や毒、栄養剤などを注入できる
  - 体内に閉じ込めた者は、サソリの体内で消化されることはないが、エネルギーやマナを吸収され続ける
  - 体内にも薬剤注入のための注射器があり、エネルギーやマナを吸収するための薬剤を注入してくる
- パーソナライズ
  - 「んー、迷い人のようだな？」
  - 「おまえの足より、オレの足のほうが早いぞ？」
  - 「恥ずかしがらずに食べられろ」
  - 「薬を打たれた気分はどうだ？」
- ボスの行動
  - 通常時
    - 「はさみ攻撃」通常攻撃
    - 「踏みつけ」通常攻撃
    - 「しっぽ振り回し」通常攻撃、命中率低いがダメージ大
    - 「しっぽ麻酔」命中率は低いが、エルナルを麻酔状態にする
      - 麻酔状態では行動できない
      - 3ターン後に麻酔が切れる
    - 「はさみキャッチ」エルナルを拘束状態にする、たまにミスする
    - 「猛毒注射」拘束状態のときのみ使用、ダメージとともにエルナルにサソリ毒状態を付与する
      - サソリ毒状態では毎ターン最大HPの1/10のダメージを受ける
      - 3ターン後に解除される
    - 「かみつき舐め回し」拘束状態のときのみ使用、ダメージを与える
  - エルナルがダウン時
    - 「大胆に丸呑み」食べられ状態遷移
  - 食べられ状態時
    - 「脱力剤注入」体内注射でエルナルに脱力剤を注入する
      - HPダメージが通常よりも1.5倍になる
      - 3ターン後に解除される
    - 「体内マッサージ」最大HPを吸収する
    - 「体内締め付け」最大HPを吸収する

実装できたらPR作って

----

新しいボス「蜜柑ドラゴン」を実装したい。

- 蜜柑の皮のような鱗と羽をもち、蜜柑の中身のようなお腹を持つドラゴン
- 体内の胃袋は蜜柑の汁のような粘液で満たされており、エルナルを体内に取り込んで培養、同族化させようとする
- 通常攻撃
  - 「蜜柑の爪」通常攻撃
  - 「蜜柑の尻尾」通常攻撃
- 蜜柑のような甘い香りを漂わせ、エルナルを誘い込む (「魅了」のデバフを受ける)
  - HP が減っているほど、蜜柑の香りに誘われやすくなる
- 蜜柑の汁のような粘液を出し、エルナルをネバネバにして攻撃力を下げる
- 長い舌をエルナルに巻き付けて拘束しようとする
- 拘束中の攻撃
  - 「蜜柑しぼり」巻き付けてる舌でエルナルの体を締める、通常のHPダメージ
  - 「蜜柑のキス」エルナルの体をまるごと加えて吸い尽くす、HP吸収攻撃
  - 「蜜柑汁注入」チューブ状の舌をエルナルの口に入れて蜜柑の汁を注入する。エルナルが「魅了」になる
- エルナルがダウン時
  - 「蜜柑の丸呑み」食べられ状態遷移
- 食べられ状態時
  - 「蜜柑汁注入」チューブ状の体内触手をエルナルの口に入れて蜜柑の汁を注入する。エルナルの最大HPを減らしながら「魅了」になる
  - 「蜜柑マッサージ」蜜柑の果肉のような胃壁でエルナルをマッサージし、最大HPを減らす
  - 「蜜柑触手くすぐり」体内触手をエルナルの体に巻き付けてくすぐり、最大HPを減らしながら「脱力」状態にする
- エルナルが「再起不能」になったときの行動
  - エルナルの体がみるみると蜜柑ドラゴンの幼体のような姿になる
  - 体内触手で蜜柑汁を注入され続け、培養されつづける

----

スキルをアンロック式にしたい。

- コンバット
  - レベル3: 「パワーアタック」スキル解禁
  - レベル5: 「パワーアタック」の威力 +50%
  - レベル7: 「パワーアタック」のクリティカル率 +20%
  - レベル9: 「ウルトラスマッシュ」スキルの解禁 (MPを全て消費。攻撃力+消費したMPのダメージを与える。クリティカル率+50%。使用後は疲れ果てになる)
- タフネス
  - レベル1: 「防御」コマンド解禁
  - レベル3: 拘束時の「じっとする」コマンド解禁
  - レベル5: 毎ターン、HPが最大HPの1/20だけ回復する (四捨五入、最低1)
  - レベル7: 「防御」中のHPダメージを100%カットする
  - レベル9: 拘束や食べられなどから抜け出すと、失った最大HPの50%を回復する
- エンデュランス
  - レベル3: 「防御」または「じっとする」コマンド時、MPが全回復するようになる
- アジリティ
  - レベル3: 拘束時の「あばれる」コマンド解禁
  - レベル5: 「あばれる」時、脱出の成否に関わらずボスにダメージを与える (攻撃力 x 1.5)

すでにある「ヒール」は一旦廃止とする。

----

セーブデータのインポート・エクスポート、削除をするためのメニューを、ボス選択画面のところに追加したい。
また、デバッグモード時に、エルナルのレベルや経験値を変更できるようにしたい。

---

プレイヤーの最大HPが減少すると、HPバーもそれに合わせて短くなるという描写を入れたい

最大HPが初期状態より増えることがあるので、その場合はHPがはみ出さないように従来通りの描写としたいです。
また、最大HPが減少した場合、バー本体も短くなる描写にしたいです。

----

新しいボス「海のクラーケン」を作りたい。

- 紫色の体と触手をもつ巨大イカ
- 深海に生息するがたまに海岸に現れ生き物をなんでも飲み込む
- 触手の吸盤や、体内にある無数の吸盤は強力な吸引力を持ち、獲物を捉えるだけでなくエネルギーを吸収できる
- 体や触腕の先から吐き出すイカスミは視界を奪うだけでなく、飲み込んでしまうと催眠効果がある
- 通常の行動
  - 「触手ビンタ」通常攻撃
  - 「叩きつけ」ちょっと威力が高いが命中率が低い攻撃
  - 「イカスミブレス」前方にイカスミを吐き出し、視界を奪う (3ターンの間、攻撃の命中率を下げる)
  - 「触腕巻き付け」拘束攻撃
  - 「触腕吸引」拘束状態のときのみ使用可能。捉えた獲物を吸盤で吸引し、エネルギーを吸収する。HP吸収攻撃
  - 「イカスミ注入」拘束状態のときのみ使用可能。触腕を捉えた獲物の口に入れてイカスミを注入し、魅了状態にさせる
- 主人公(エルナル)がダウン＋拘束時
  - 捉えた獲物を触腕ごと口に押し込み獲物を飲み込む
- 食べられ状態時
  - 「胃袋吸盤吸引」体内の獲物のエネルギーを、胃袋にある無数の吸盤で吸収する。威力の高い最大HP吸収攻撃
  - 「体内イカスミ漬け」体内の獲物をイカスミ漬けにする。最大Hpを吸収しながら魅了状態にさせる
- 主人公(エルナル)が「再起不能」になったときの行動
  - エルナルはイカスミを注入されがら吸盤で吸収されるのを永遠に繰り返され、
    クラーケンの体内でエネルギーを吸収され続けることになる

実装が終わったらブランチ切ってPR出してください

----

(変になったのでやめた)

攻撃やスキルなどの処理を共通化するために `Action` クラスを作成したい。まずはクラスの内容だけを定義する。

- `Action` クラスは以下のプロパティを持つ
  - `name`: スキル名
  - `description`: スキルの説明
  - `target`: 対象 (自分自身か、敵か)
  - `mpCost`: マナ消費量
  - `message`: 行動時のメッセージ (リストで複数行のメッセージを指定可能)
    - メッセージはフォーマット指定可能 (例: `<USER>は<TARGET>に<ACTION>を使った！`)
  - `repeatCount`: 繰り返し回数 (通常は1。2以上で「命中判定→ダメージ→特殊効果」の処理を繰り返す) 省略時は 1
  - `accuracy`: 成功率 (0.0 - 1.0) 。失敗時はダメージや特殊効果は発生しない
  - `accuracyType`: 成功率計算タイプ (`fixed`:固定、 または `evade`: 使用者の命中補正と対象の回避率を参照)
  - `damageParameter`: ダメージ計算パラメータ
    - `targetStatus`: ダメージの対象 (HP, MP, 最大HP, 最大MP)
    - `type`: ダメージのタイプ (ダメージ、回復、吸収)
    - `formula`: ダメージ計算式 (例: `20` `a.attack * 2.5` `a.attack * 0.5 - b.attack * 0.5`)
    - `fluctuation`: ダメージのゆらぎ係数 (デフォルトは0.2)
    - `criticalRate`: クリティカル率 (デフォルトは0)
  - `extraEffects`: 対象に発生する追加効果のリスト (複数かつ異なるタイプの効果を指定可能)
    - ステート (状態異常) の付与
      - `state`: ステートの種類
      - `probability`: 発生率 (0.0 - 1.0)
      - `duration`: 継続ターン数、省略時はステートのデフォルト継続ターン数
      - `value`: 効果値 (例: 毒の毎ターンダメージ量など)、省略時はステートのデフォルト値
    - ステートの解除
      - `state`: 解除するステートの種類
      - `probability`: 解除の成功率 (0.0 - 1.0)
    - 任意実行
      - `function`: 実行する関数 (引数は使用者と対象)
- 通常攻撃用に、上記を用いて `SkillNormalAttack` クラスを作成。想定されるパラメータは以下の通り
  - name: "通常攻撃"
  - description: "通常攻撃"
  - target: 'enemy'
  - mpCost: 0
  - message: ["<USER>の攻撃！"]
  - accuracy: 1.0
  - accuracyType: 'evade'
  - damageParameter: 
    - targetStatus: 'hp'
    - type: 'damage'
    - formula: "a.attack" (ラムダ式で指定？)
    - fluctuation: 0.2
    - criticalRate: 0.05
  - extraEffects: []
- 1回分の行動結果を表すクラス `ActionResult` を作成
  - `success`: 行動が成功したかどうか
  - `hpChange`: HPの変化量 (正の値は回復、負の値はダメージ)
  - `mpChange`: MPの変化量 (正の値は回復、負の値はダメージ)
  - `addStates`: 追加されたステートのリスト
  - `removeStates`: 解除されたステートのリスト

Action はあくまで行動結果を計算するためのパラメータを定義するものとしたいです。
現在の実装にあるような、ボスの行動条件などは Action の外側で定義します。

Action.ts の内容を少し改変しました。

次に、Actionと使用者のActor、対象のActorを引数にとって、行動結果 `ActionResult` を計算する `ActionExecutor` クラスを作成します。

----

新しいボスについて考えたい。今考えているのは以下の通り。

- 大海原を泳ぐヘビ型の龍
- 青い体をもち、体内が淡く光っていてお腹が透けて見える
- 体内の光は獲物からエネルギーを吸収することで強くなる
- 海にさまよう生命体を飲み込み、長い体を通過させながらエネルギーを吸収する習性をもつ
- 見つけた獲物に対して口から水のブレスを吐いたり、長い体を叩きつけたりして攻撃。その長い体で拘束することも
- 長い体で獲物を拘束したら、体で締めたり、獲物を咥えてキスをしたりして体力を奪い、弱らせてから丸呑みにする
- 体内に閉じ込められた獲物は、体内の光に照らされながら長い体内を通過させられる。お腹が透けているので、外からお腹の獲物が見えたり、中から海の様子が見えたりする
- 体内の獲物を津波のような胃液で洗いながらさらに獲物を弱らせ、吸収効率を高める
- 尻尾まで運ばれた獲物は普通は近くの海岸に吐き出されるが、まだエネルギーが足りないと感じると、再び飲み込んでしまう。

以下の方針で実装を進めましょう。作業ブランチ切った後に作業して、作業ごとにコミットしてください。全て終わったらPRを作成してください。
use context 7.

# 海の龍「アクアサーペント」

- 基本攻撃技
  - 水圧ブレス
    - 口から高圧水流を発射
    - 中威力の水属性攻撃
    - 低確率で「水浸し」状態異常（防御力ダウン）
  - 津波の一撃
    - 尻尾で水を巻き上げて叩きつける
    - 高威力の物理攻撃
    - 水しぶきでプレイヤーの視界を遮る
  - 渦潮スラム
    - 長い体をうねらせて全身で攻撃
    - 中威力、命中率やや低め
    - ヒット時に「目眩」状態異常
- 必殺技 (通常時)
  - 深海の審判
    - HP30%以下で使用、使用後クールダウン20ターン
    - 海水を操り巨大な水の檻を作成
    - 大ダメージ + 高確率で拘束状態
- 拘束・特殊技
  - 海蛇の抱擁
    - 長い体でプレイヤーを巻き付け拘束
    - 拘束状態に移行
  - 深海のキス
    - 拘束中のみ使用可能
    - プレイヤーの体ごとキスして体力とMPを吸収
  - 丸呑み
    - 拘束中にプレイヤーのHPが0になると使用
    -「食べられ」状態に移行、体内に閉じ込められる
- 体内技（食べられ状態中）
  - 胃液の嵐
    - 体内で津波のような胃液を放出
    - 最大HPを吸収
  - 蠕動運動
    - 体内の壁が収縮してプレイヤーを押し流す
    - 最大HPを吸収
  - 体内発光
    - 体内の光が強くなりプレイヤーを幻惑
    - 「魅了」状態異常
  - 生命吸収の渦
    - 体内にいるプレイヤーから大量の生命力を吸収
    - 大ダメージ + 吸収
    - 使用後は一定確率でプレイヤーを吐き出す (食べられ解除)
- 再起不能時の行動
  - 「アクアサーペントの体内で力尽きた<プレイヤー名>は、蠕動運動によってさらに体内への奥へと引きずられていく…」
- 再起不能行動後の、ボス無限体内行動
  - 「胃液でゆっくり体を洗われる」「激しい蠕動運動でさらに奥へ」「マッサージされながら、透けた体内から外の深海を眺める」「体内で渦を起こされてぐるぐる目にされる」などといったメッセージがランダムで表示される
  - 10ターンごとに尻尾から出され、そのまま口から再捕食される描写が発生
    

透明腹部
体内のプレイヤーが外の海の様子を見られる演出
戦闘には直接影響しないが、没入感を高める
「透明な腹部越しに海の光が見える...」

----

このボス作成ガイドの情報は古くなっているので、現在の実装と異なるものがあれば修正したい。クラーケンやアクアサーペントあたりが新しい方の実装になっているのでそれらも参考に。

----

デバッグモード時、バトル画面にデバッグボタンを追加し、そのボタンからデバッグ機能のある画面に飛べるようにしたい。

- プレイヤー・ボスのHP/MP、StatusEffectの詳細閲覧・編集。
- ボスの Custom Variables の状態閲覧・編集。

use context 7. 作業ブランチを先に作って。作業ごとにコミットしてください。

デバッグ画面をシーンの1つとして追加しましたが、以下の問題点があるようです。

- BattleScene が破棄されてしまうため、デバッグ画面から戻った際にバトルの最初からになってしまう。

以下のように修正していきたいです。

- デバッグ画面はバトル画面の上に Model で重ねて出すようにして、デバッグシーンは使わないようにしたい (バトル前画面の主人公ステータス詳細画面のように。)
- デバッグ画面を開く時、HP・MPは現在値が入っている状態にしたい。

BossSelectScene でも isDebugMode があり、個別でデバッグモードを判定している。GameクラスのisDebugMode()と統合したい。

また、 npm run dev 時、 `?debug=true` が付いた状態でブラウザが開くようにしたい。

----

UI改善したい所を列挙します。作業ブランチで実装し、作業ごとにコミットすること。
use context 7.

- BossSelectScene で使っている showMessage を bootstrap による toast を使った通知にしたい。またどのシーンでも使えるように汎用化したい。
  - bootstrap toasts: https://getbootstrap.jp/docs/5.3/components/toasts/
  - デバッグ画面にて `alert()` を使っている所を、上記の toast でメッセージを出せるようにしたい。
- デバッグ画面やセーブデータ消去画面で `prompt()` や `confirm()` を使っているが古いブラウザの機能である。 bootstrap によるUIに差し替えたい。ただし modal は一度に1つしか使えないはずなので別の方法または工夫して実装する必要がありそう。

----

いくつかの修正をしたい。
「「悪夢の投影」という精神攻撃に対して毒状態異常は概念的に不整合です。混乱や恐怖など、精神的な効果により適した状態異常の使用を検討してください。」というCopilotのツッコミを受けて、闇のおばけの食べられ時行動を改良したい。また専用の状態異常を追加したいです。

- 「恐怖の注入」は他のスキルとの差別化が難しいため削除
- 通常の食べられ時攻撃のバリエーションに1つ追加
  - 「魂の引き抜き」体内にいる獲物の魂を影の触手で引き抜こうとする
- 「絶望の囁き」「恐怖の注入」で「恐怖」状態を与えるようにする
  - 状態異常「恐怖」を追加
    - 効果: 被ダメージが 1.5 倍
    - 継続ターン数: 3ターン
- 「記憶の侵食」で「忘却」状態を与えるようにする
  - この攻撃は20ターンのクールダウンを設定 (ハメ防止)
  - 状態異常「忘却」を追加
    - 効果: スキル使用不可
    - 継続ターン数: 3ターン

作業ごとにコミットしてください。全て終わったらプッシュ。 use context 7.

----

仮タイトルを「Eel Feed」としていたが、そろそろちゃんとしたタイトルを決めたい。

もともとはウナギのキャラ（Eel）が餌を与える（餌になる）（Feed)という意味合いだが、これに合わせてエルナル（Elnal）が餌になる（Feeds)という意味で「Elnal Feeds」というタイトルが一つの案。
これに「The Elnal Feeds」といったものを後ろに付けて「ElnalFTX」というタイトルにするのも考えたが、XXXにあたる単語が浮かばなかったので保留にしている。
もしよければ、XXXにあてはめる単語や、もっと別のタイトル案があれば、列挙してほしい。

----

エルナルに新しいアビリティ「エクスプローラー」を追加したい。

- フレーバーは「エルナルがボスとの戦いを通じて得た経験で、探検できる範囲が広まる」という意味
- エクスプローラーレベルを挙げると、新しいボスとの戦闘がアンロックされる。
  - 最初、ボスは「沼のドラゴン」「闇のおばけ」「機械のクモ」としか戦えない
  - レベルを上げるごとにボスがアンロックされていく (これは BossData に記載できるようにする。ボス作成ガイドもこれに合わせて更新したい)
    - レベル1: 運び屋のサソリ (砂漠関係のボス)
    - レベル2: クラーケン、アクアサーペント (海関係のボス)
    - レベル3: 夢魔ちゃん (ゲストキャラ関係)
    - レベル4: 蜜柑ドラゴン (ジャングル関係のボス)
    - レベル5: (洞窟・地下世界関係のボス、今は誰も居ない)
    - レベル6: クリーンマスター (遺跡・廃墟関係のボス)
    - レベル7: (氷河・雪山関係のボス、今は誰も居ない)
    - レベル8: (火山・溶岩関係のボス、今は誰も居ない)
    - レベル9: (天空・宇宙関係のボス、今は誰も居ない)
    - レベル10: (魔界・冥界関係のボス、今は誰も居ない)
  - エクスプローラー経験値を上げる手段
    - ボスを初めて倒すと得られる記念品 (経験値は解禁レベルに応じて変化)
      - 経験値 = (そのボスの解禁レベル + 1) ^ 2 * 100
      - 例: 沼のドラゴンを倒すと「沼のドラゴンのたてがみ」を入手し、エクスプローラー経験値を100得る
    - ボスに初めて負ける (とどめ攻撃を受ける) と得られる記念品 (経験値は解禁レベルに応じて変化)
      - 経験値 = (そのボスの解禁レベル + 1) ^ 2 * 100
      - 例: 沼のドラゴンに負けると「沼のような粘液」を入手し、エクスプローラー経験値を100得る
    - 1回の戦闘でボスから受けたスキルの種類に応じて経験値を得る
      - 管理複雑化を防ぐため、単に受けたスキル名の数をカウント。受けたスキル数 * 20 * (そのボスの解禁レベル + 1) の経験値を得る

実装はブランチ上で行う。作業ごとにコミットしてください。 use context 7.

- 「エクスプローラー」アビリティをエルナルのアビリティ一覧にも表示させたい。
- 未解禁のボスは選択できないのではなく、非表示としたい。

- バトル中、左下のボス選択に戻るを押すと、まだ負けていないのに負け扱いになってしまうので、初回負け記念品を受け取った扱いになる。負けていないときは「中断した」ということにしたい。
- 記念品を受け取ったことや、エクスプローラーのレベルアップによるボス開放をバトル結果画面に表示したい。

Trophy を内部データ用とセーブデータ用に分離したい。

- 内部データ用
  - BossData に持たせるデータを想定 (ボスごとにテキストを定義できる。勝利時・敗北時の2つ)
    - 記念品名
    - 記念品の説明
- セーブデータ用
  - 獲得したトロフィーID
  - 獲得した日時

ボスの解禁レベル分布の説明で、地域ごとにレベル分けしていることを明記したい。

- レベル1: 砂漠
- レベル2: 海
- レベル3: ゲストキャラ関係
- レベル4: ジャングル
- レベル5: 洞窟・地下世界
- レベル6: 遺跡・廃墟
- レベル7: 氷河・雪山
- レベル8: 火山・溶岩
- レベル9: 天空・宇宙
- レベル10: 魔界・冥界 (理不尽度 MAX!)

新ボス設定ガイドに、勝利時記念・敗北時記念に関する記載を入れたい。勝利時の記念品は「ボスの外側から採れるアイテム」、敗北時の記念品は「ボスの体内から採れるアイテム」とする。
「新ボスファイルの作成」における項目において、 BossData を参考に記念品データの実装方法について記載すること。


エルナル詳細画面の探検タブで、現在のエクスプローラーレベルでどこの地形に行けるかというフレーバーなテキストを追加したい。

- レベル0: 近隣の地方
- レベル1: 砂漠
- レベル2: 海
- レベル3: (ゲストキャラ関係、表示はしない)
- レベル4: ジャングル
- レベル5: 洞窟
- レベル6: 遺跡・廃墟（２つ表示）
- レベル7: 寒冷地
- レベル8: 火山
- レベル9: 天空
- レベル10: 魔界

CLAUDE.md からコーディング規則周りを SCRIPTS_DOCUMENTATION.md に移動したい。CLAUDE.md から参照できるようリンクを貼ること。

----

アクアサーペントで isDefeat 中に10ターンごとに行う行動で(turn % 10 === 0)を用いてるが、isDefeat()が始まったターンからカウントして10ターンごとに行うようにしたい。

----

現在エクスプローラーレベルで地域ごとにボスがアンロックされる仕組みとしているが、現在ボスのいない地域があるので、それらに対応するボスの簡単な案を出してほしい。

----

新しいボス「コウモリ獣人」を実装するためのアイデアを固めたい。今は一旦アイデアのみとし、実装は置いておく。

- コウモリの獣人、古城に住む吸血鬼
- コウモリの翼、尻尾、牙を持つ
- 獲物をあのてこのてで城に招き入れては、獲物に噛みつき生気を吸い取る
  - 生気を採られすぎた獲物はコウモリ獣人の魔力にあてられ体が小さくなる
  - 小さくなった獲物を丸呑みにし、生気を吸い尽くすために体内に閉じ込める
  - 胃袋には触手や牙などがあり、生気を吸い取るためでなく、『給餌』などお世話のために使われる
- エルナルとの大きさはやや大きいくらいのため、直接丸呑みはできない
- 性格は表向きは紳士的だが、内心は獲物を陥れることに喜びを感じている
  - 体内に獲物を飼うことを楽しむ
- 通常攻撃
  - 「爪で引っ掻く」「尻尾で叩く」通常攻撃
  - 「子コウモリ放出」複数のコウモリを放出して攻撃
  - 「シャドウバレット」影の弾を放出して攻撃、命中率は低いが「暗闇」状態にすることがある (攻撃命中率が大きく低下)
  - 「ヴァンパイアホールド」強力な握力でエルナルを捕まえて拘束状態にする
- 拘束中の攻撃
  - 「生気吸収」拘束状態のときのみ使用、エルナルの体力とMPを吸収する
    - HPダメージとMPダメージを与える
  - 「コウモリのキス」拘束状態のときのみ使用、エルナルに深いキスをして生気を吸い取りながら魅了させる
    - エルナルが「魅了」状態になる
- 拘束中＋エルナルがダウン時 (※丸呑み攻撃はしない)
  - 「生気吸収」名前は同じだが、ダウン時に受けた場合は異なる効果
    - エルナルの最大HPが吸収される
- エルナル再起不能 (最大HPが0になったとき)
  - 最大HPが0になる＝生気を吸い尽くされ、体が小さくなってしまう
  - コウモリ獣人は小さくなったエルナルを丸呑みにし、体内に閉じ込める (負け状態)
- 負け状態時
  - 胃袋の様々な器官で生気を吸われ続ける (胃袋の吸収器官、体内触手、体内牙など)
  - 胃袋マッサージや体内くすぐりなどでエルナルを魅了させる
  - コウモリ獣人が定期的に(15~20ターンくらい？)『給餌』(エルナルに食事させるために胃袋に食べ物を入れる) を行い、体内器官で食べさせられる
  
追加の情報
- 解禁エクスプローラーレベル: 6 (古城に住む設定なので、最も雰囲気が近いレベルにしました)

ここまで纏めた内容を元にボス「コウモリヴァンパイア」実装を進めてください。情報は docs/bat-beastman-boss-idea.md に纏めています。内部名はbat-vanpireにします。ブランチは作成済みです。作業単位ごとにコミットしてください。use context 7.

細かい挙動修正をしたものをコミットしたので確認してください。
現在、ボス行動名を name で指定しているが、 name は表示用なので、代わりに内部の識別名を用いて指定できるように、 BossAction クラスに `id` プロパティを追加したので、これを用いて行動指定したい。

ボスのとどめ攻撃 (player が isDoomed になった後に出す行動) は現在、 finishingMove 内のメッセージを出すのみとなっているが、これを抑制するオプション `suppressAutoFinishingMove` を追加したい。これによって、コウモリボスの専用のとどめ攻撃を出すことができるようにする (内容は docs/bat-beastman-boss-idea.md に纏めています)。

----

claude の実装後にコード改修を行ったので、一度確認すること。

そのうえで、以下の修正をしたい。修正ごとにコミットすること。 use context 7.

- 「眷属の催眠術」行動の追加
  - 拘束状態が連続5ターン続くと使用する (20ターンのクールダウン)。
  - 高い確率 (90%) で対象を2ターンだけ「催眠」状態にする (statusDuration: 2)
    - 効果: 行動できなくなる
- 「給餌タイム」を2つの行動(2ターン)に分割
  - 「食事の時間」: コウモリが (獲物が入っている胃袋とは別の) 胃袋に食べ物 (パン) を入れる
    - 自身への食事だけでなく、獲物に給餌するために食べ物用の胃袋で食べ物を消化する
    - 「胃袋の外側から、くぐもった蠕動の音と、食べ物が消化されていく轟音が響き渡る...」(←現在は仮)というような、もう一つの胃袋の存在を感じさせるメッセージを出す
  - 「給餌の時間」: 消化されて液状になった食べ物の一部が、触手管など体内器官を通じてエルナルに『給餌』する
    - 「エルナルは管のような器官を口に入れられ、どろどろになった食べ物を飲まされ続ける」というようなメッセージを出す

----

地底のワームにとどめ行動、敗北イベント行動、記念品の設定がないので設定したい。


いくつかの問題がある:

- ボス選択後、戦闘開始ボタンの `ボスデータ読み込み中` メッセージが出たままになり、2戦目以降が遊べない。
- npm run dev 時に以下の警告が出る。
```
Compiled with problems:
×
WARNING
asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).
This can impact web performance.
Assets: 
  main.js (394 KiB)
WARNING
entrypoint size limit: The following entrypoint(s) combined asset size exceeds the recommended limit (244 KiB). This can impact web performance.
Entrypoints:
  main (567 KiB)
      vendor.js
      utils.js
      main.js
```

----

以下のように修正していきたいです。作業ブランチを作って、作業ごとにコミットしてください。 use context 7.

- unlockedSkill, unlockedItem は現在の実装ではアビリティレベルから逆算できるため、セーブデータへの保存は不要のように思われます。
- ボスデータのメタデータの difficulty は不要なので削除したい。
- ボスデータのメタデータを逐一 index.ts に転写するのは手間になりそう。メタデータ生成を自動化したい。
- ボスの記念品がメタデータに無いためか、探検記録に記念品を表示できない状態のようです。

----

BossAction の id プロパティを必須にするために、既存の BossAction に id を追加したい。id は BossAction の識別子で、ボスの行動を指定するために使用される。 id は同じボス間で一意である必要がある。ブランチで作業し、作業単位ごとにコミットすること。

----

以下の実装を進めたい。

- ボスを倒したときに、戦闘終了メッセージが2重に出るバグを修正したい
- ボスデータに「戦闘開始時のメッセージ進行」「エルナル勝利(ボス討伐完了時)のメッセージ進行」を追加できるようにする。
  - メッセージ吹き出し元を変えられる形式にしたい（エルナル、ボス、システムメッセージ）

----

修正したい不具合

- スキル「ウルトラスマッシュ」がスキル欄に出てこないのを修正したい。
- アイテム「おまもり」を拘束状態・行動不能状態でも使えるようにしたい。（「なすがまま」の上に出るようにする。ただし負け状態では使えなくなる）
- 拘束状態・行動不能状態で、デバッグボタンが非表示になってしまうのを修正したい。

----

各ボスのパーソナライズ情報 (性格、設定など) を docs/characters/ に纏めたい。

----

新しいボス「ふかふかドラゴン」を実装したい。以下の内容を参考にして、ボスの設定を固めてください。

- 寒冷地地方のボス
- 真っ白で深い体毛、ベージュ色の柔らかい蛇腹をもつドラゴン
- 体毛はふかふかで、触れると心地よい感触、ドラゴンの翼もふかふかな毛に覆われている
- 見つけた獲物を様々な方法で誘い込み、ふかふかの体毛に包み込んで拘束する
- 眠りのブレスによって獲物をうとうとさせ、抵抗力を奪う
- 眠りを誘うラベンダーの香りがする
- ふかふかの体毛で力が抜けたり、マナ切れで疲れ切った獲物はそのまま丸呑みにされる
- 食べられた獲物は寝袋のような食道を通り、ふかふかな毛に覆われた胃袋に閉じ込められる
- ふかふかな胃袋は獲物を眠らせるための器官で、柔らかく、獲物を優しく包み込みながら眠りに誘う
- 完全に眠ってしまった獲物は第二の胃袋に送られる。
- 第二の胃袋は、ふかふか胃袋と異なり毛に覆われておらず、柔らかくもヌメヌメした胃壁で獲物からエネルギーを搾り取る
- 第二の胃袋に収められた獲物はふかふかドラゴンの睡眠を肩代わりすることになり、ふかふかドラゴンが起きている限り獲物は目覚めることができず、ふかふかドラゴンが考える「恐ろしい夢(食べられる夢)」を見させられる

(作った後すごい微妙になってしまったので廃案)

----

新しいボス「天空の不死鳥」を実装したい。以下の内容を参考にして、ボスの設定を固めてください。

- 天空地方のボス (エクスプローラーレベル9)
- 真っ白な体毛、透き通るような虹の羽毛を持つ不死鳥
- 体毛は柔らかく、触れるとほんのり温かい
- 天空の雲の中に巣を作り、普段は姿を見せない
- 時折地上に降り立つことがあり、不用意に近寄った生き物 (獲物) を「永遠の命を得るために生贄になる生き物」と勝手に判断し、捕まえようとする
- 獲物を捕まえる前に、突いたり踏みつけたりするなど痛めつけて弱らせる
- 自身の力で燃やすこともある。生贄にさせる必要があるので完全に焼き尽くすことはない
- そうして獲物が力尽きたらくちばしで捉え一呑みする
- 飲まれた獲物はまず嗉嚢に送られる。その中は灼熱の炎のような熱気に満ちており、獲物はその熱気に焼かれながら生命エネルギーを注入させられる
- 生命エネルギーを注ぎ込まれ永遠の命を得た獲物は、さらに奥深くの胃袋に送られる
- 胃袋に送られた獲物は脱出することはできず、灼熱の胃液と激しく動く胃壁に揉まれながら、永遠に (不死鳥の気が済むまで) 生贄としての役割を果たすことになる

(普通のボス敵が出来てしまったので廃案)

----

index.html の内容を確認して、以下の修正を行いたい。

- ボス一覧のカードをスクリプト側で内容生成するようにしたい。必要なデータは BossData から取得するようにする。
- ボスカードを以下の順で並び替えたい
  - エクスプローラーレベル順に（小さい方を先に）
  - 同じ場合は id 名順に

作業ごとにコミットすること。use context 7.


- html の内容が増えてきたので、tsシーンごとに分割できるようにしたい。


計画書にあった以下の実装もお願いします

    Phase 2: 共通ユーティリティ抽出

    - AbilityNameResolver: アビリティ名変換の統一

    Phase 3: UI コンポーネント化

    - TrophyDisplayComponent: トロフィー表示UI
    - EquipmentSelectorComponent: 装備選択UI


index.html の内容を確認して、以下の修正を行いたい。

- html の内容が増えてきたので、tsシーン・コンポーネントごとに分割したい。

index.html は各シーン ts や個別コンポーネント ts で用いてるため、 agent でそれらの解析を行い、tsがどの部分のHTMLを用いているか把握すること。

作業ごとにコミットすること。use context 7.

----

細かい手直しを進めていきたい。

- アビリティレベル表示カードに、各アビリティの基本的な効果説明を追加したい。
  - 経験値を貯める方法 (具体的な値は記載せず、概略のみ記載)
  - アビリティレベルを上げることによる効果 (具体的な値は記載せず、概略のみ記載)
- 探検記録タブの解禁済みボス数の母数がHTML固定で9となっているので変更させたい。
- デバッグのアビリティレベル変更にエクスプローラーが入っていないので追加したい。

<p class="mt-2 mb-0 small">探検できる範囲が広がり、新しいボスとの戦闘がアンロックされます</p>

各アビリティの経験値の上げ方は以下の通りです。
- コンバット: ボスにダメージを与えた量だけ経験値獲得
- タフネス: 減ったHPの量だけ経験値獲得
- クラフトワーク: アイテム使用ごとに経験値獲得
- エンデュランス: MP消費ごとに経験値獲得
- アジリティ: 拘束攻撃の脱出を試みるごとに経験値獲得
- エクスプローラー: ボスを初めて倒すか負ける (記念品を受け取る) か、ボスからスキルを受けるごとに経験値獲得

アビリティレベルが最大 (10) になったときの表示を以下のようにしたい。

- プログレスバーは100％にし、黄色 (warning) に変更し、ストライプアニメーション表示にする。
- 経験値の分母の表示は、アビリティレベル10に必要な経験値量にする

----

新ボスの公募をするにあたって、案を出してもらう人に書いてほしいボスの情報を纏めたい。

まず、ボスの現在の実装方法やボス作成ドキュメントをagentで解析して、ボス作成において必要となる情報を分析したい。
その後、ボス新規作成の公募必要となる情報をまとめる。
ボス案はGoogle Formで情報収集する予定で、そこで入力されたフォーム情報をもとに、最終的にclaude codeへのプロンプトを生成できるようにするという想定です。
GoogleFormの推奨される内容の提案と、入力結果をClaude Codeプロンプトに変換する例を提示してほしい。
コードの実装は進めなくてよいです。

以下の内容修正をする。
- 難易度設定は無しでよいです。(ボスの強さはフレーバー寄りであるため、また難易度はエクスプローラーレベル(生息地)で調整されるため)
- 最も重要な「プレイヤーへの捕食行動」「丸呑みにしたプレイヤーに対する行動」は必須としてください。

フォームのイメージは以下の通りです。

- 基本情報
  - ボス名
  - ボスの絵文字
  - ボスのモチーフ
  - ボスの生息地
- 戦闘設定
  - (任意)戦闘スタイル
  - (任意)HPと攻撃力のバランス(9段階で、HP寄り・攻撃力寄りを設定) 
  - (任意)特殊行動アイデア
  - (任意)使用する状態異常アイデア(拘束や食べられなど、コアシステムのものは除く)
  - 拘束技アイデア
  - 捕食行動アイデア
  - 丸呑み後の行動アイデア
  - (任意)敗北イベント(丸呑み状態で最大HPが0になったとき)の行動アイデア
  - (任意)敗北イベント後の体内永久ループの行動アイデア
- 細かいキャラクター設定
  - (任意)背景ストーリー
  - (任意)ボス選択画面で表示する「討伐クエストっぽいテキスト」案
  - (任意)ボス戦闘開始前のセリフ案
  - (任意)ボス討伐時のセリフ案
  - (任意)ボスの性格やセリフ
  - (任意)勝利時の記念品
  - (任意)敗北時の記念品
  
情報がまとまったら、 docs/drafts/ フォルダに md ファイルとして保存してください。

----

Actor の修正

- コンストラクタでパラメータが設定されているが、基本的に子クラスが計算したものを後に設定するため、基本的にはパラメータ設定は不要のように思える (ただしゼロ除算などを防ぐためHP/MPは仮の値を入れておくのはあり)
- 冗長なUI表示メソッドは削除してもよさそう
- Actor はあくまで抽象クラスという設定なので、ゲームバランスに関わる値はここでは記載しない
----

新しいボス「ふわふわドラゴン」を実装したい。以下の内容を参考にして、ボスの設定を固めてください。
他のボスを agent で解析して、実装方法を確認してください。

- 寒冷地地方のボス
- 真っ白で深い体毛、ベージュ色の柔らかい蛇腹をもつドラゴン
- 体毛はふわふわで、触れると心地よい感触、ドラゴンの翼もふわふわな毛に覆われている
- 見つけた獲物を様々な方法で誘い込む
- ラベンダーの香りがする眠りのブレスによって獲物をうとうとさせる
  - 通常は「眠気」を与える（MP回復と拘束脱出確率が減る）。「疲れ果て」か「行動不能」の状態で受けると「睡眠」状態にする（3ターン行動できない）
- 眠ったり、行動不能になった獲物を抱きかかえるようにして拘束する（通常状態でもたまに拘束技を使う）
- 構想状態時、眠ったり、行動不能になった獲物はそのまま丸呑みにされる（食べられ状態になる）
- 食べられた獲物は寝袋のような食道を通り、ふわふわな毛に覆われた胃袋に閉じ込められる
- ふわふわな胃袋は獲物を眠らせるための器官で、柔らかく、獲物を優しく包み込みながら眠りに誘う（胃袋というより嗉嚢かもしれない）
- ふわふわ胃袋に入っている（食べられ状態）獲物は、揉んだり、眠りの空気を送り込むなどで最大HPを奪い取っていく
- 最大HPが0になった獲物は完全に眠りに落ちたということになる (再起不能状態)
  - この状態になった獲物はより奥の胃袋に送られる
- 奥の胃袋は、ふわふわドラゴンの眠気や睡眠を獲物に与えるための器官
  - 本物の胃袋のようにねっとりした粘液に満ちており、獲物はその粘液に包まれながら深い眠りに落ちる
  - ここに送られた獲物は、ふわふわドラゴンが起きている限り目覚めることはできない
  - 寝心地はよいが胃袋のような質感に包まれるため、大抵は丸呑みされる夢を見続けることになる

再起不能(doomed)になった状態からとどめ攻撃の実装もお願いします(ふわふわ胃袋→奥の胃袋のくだり)。
また、その後の負け状態イベント行動(isDefeated)の実装もお願いします(奥の胃袋)

----

天空（エクスプローラーLv9）で解禁されるボスを考えている。過去のボス例は、docs/drafts/2025-07-27-new-boss-analysis-and-proposal.mdに記載されている。

- イメージは「天使っぽいマスコットキャラクター（ただしとても大きい）」
- 天使のわっかと天使のつばさを持つ
- 眼の前の生き物をなんでも「救済が必要な存在」としてつきまとってくる。ただしとても大きいので、押しつぶしたりしてダメージを与えてしまう
- 長い舌で舐めると不幸を取り除くと信じているので、舐め回してくることがある（ご利益のある粘液だらけにさせられる）
- 翼で抱くようにすり寄って拘束することがあり、そのまま抱きしめたり、じっくり舐め回したりする
- 倒れた生き物は捕まえてそのまま丸呑みして、じっくり「救済」するための胃袋に閉じ込める

行動不能になる StatusEffectType.SalvationState の状態異常を与える行動（２つ）は20ターンのクールダウンを設けたい。

- PostDefeatAttack にもあるがこちらは負けた後の演出なのでここは編集しない。

----

新しいボス「双面の道化師デュアル」を実装したい。具体的な内容は `docs/drafts/dual-jester-character-design.md` に纏めている。

- エクスプローラーレベルは 9 とする。

----

getDebuffChanceModifier() を実際のゲームに反映させたい。

- デバフを受ける可能性に影響する
- デバフの設定確率が 1.0 (確実) に設定されているものは影響しないとする

デバフを与える処理をどこで行っているか解析して実装を進める。
作業前にブランチを作成し、作業ごとにコミットすること。作業を終えたらコードレビューをAgentに依頼し、必要に応じて修正すること。終了したらPRを発行する。

----

エクスプローラーLv10用のボスの草案を考えてほしい。現在のボス実装やボス作成ガイドを解析し、Lv10ボスのデザイン方針を考える。

- Lv10 ボスは魔界・冥界地方を生息地とする予定。
- Lv10 ボスは理不尽な強さでもよい想定。

草案を一旦 docs/drafts/ にまとめておいてほしい。実装するボスを検討してから実装を進めたい。

コアシステムの1つである、各ボスの拘束技、戦闘不能プレイヤーを食べる技、食べたプレイヤーに対する行動、敗北イベント行動もそれぞれ考案し、草案テキストに記載してほしい。

敗北イベントだが厳密には2つ有る。「プレイヤーの最大HPが0になったときに行うとどめ行動」と「とどめ行動後にボスが体内のプレイヤーに対して行う永久的な行動」の2つである。これを踏まえて草案を少し書き直してほしい。

----

プロンプトや説明などをする際、「isDoomed状態(再起不能、最大Hp0になっている状態)」と「isDefeated状態(再起不能状態でボスからとどめ行動を受けた後)」を区別するための言葉を定義したい。

----

現在の BossSelectScene を以下に分割したい。

1. ボス選択画面 OutGameBossSelect
    - 現在の BossSelectScene の UI をそのまま使用。
2. プレイヤー詳細画面 OutGamePlayerDetail
    - プレイヤーの詳細情報を表示する画面。現在のプレイヤー詳細モーダルから、1つのシーンに変換する。
    - ステータス・装備・スキル・アイテムのタブ分けはそのまま使用。
3. 探検記録画面 OutGameExplorationRecord
    - 探検記録を表示する画面。現在のプレイヤー詳細モーダルから探検記録タブを抜き出して、1つのシーンに変換する。
4. 資料庫画面 OutGameLibrary
    - ゲーム内の資料を表示する画面。新規実装。
    - ゲームのフレーバーテキストを読むことができる画面。読みたい資料のタイトルボタンを押すと、資料の内容が表示される。画像なども付けられる。
    - 資料の内容のデータ定義は .md ファイルから読み込めるようにしたい。
    - プレイヤーのエクスプローラーアビリティレベル、ボスとの戦闘経験によって、閲覧できる資料が増える。（主人公が書いたレポートが増えていくというイメージ）
    - 内容の本実装は後に実施したいため、今回の作業では1個の資料のみを表示する簡易的な実装とする。
5. オプション画面 OutGameOption
    - ゲームのオプション設定を行う画面。現在のプレイヤー詳細モーダルからデータ管理タブを抜き出して、1つのシーンに変換する。

これらのシーンは、画面上部のナビゲーションバーを共有し、シーン間の遷移をスムーズに行えるようにする。（フッターも共通とする）

作業前にブランチを作ること。作業単位でコミットし、実装を終えたら agent にコードレビューをもらって必要なものを修正すること。実装完了後にPRを作成すること。 use context 7.


----

リーパーの設定をもっと詰めたい。以下の設定修正は入れておきたい

- リーパーは生物を直接殺すことはできないが、魂を刈り取ることはできる (主人公が本当に死ぬのはナシ)
- 魂が体内に入っていてもがいていると興奮してしまう (とても癖になるらしい)

----

npm run dev 実行中、 ejs を更新してもホットリロードが効かないので、ホットリロードが効くように修正したい。

BattleResultSceneの中身が大きくなると、cardがスクロール範囲外（特に上部）にはみ出してしまうことがあるので調査したい。

- 「狂気の遊び場」蠢く肉壁にメリーゴーランドのようにぐるぐる回される、みたいな描写にしたい
- 「おもちゃ部屋襲撃」引き裂かれていくという表現は少し過激なのでもう少しソフトに、例えばおもちゃに舐め回されるとか
-

----

ModalUtils の改良をしたい。

- タイトルの指定ができる showToast を実装したい。 (message, title, type)
- CLAUDE.md に alert(), confirm(), prompt() の代わりに ModalUtils のメソッドを使うように指示を追加したい。

ブランチ上で作業し、作業ごとにコミットし、完了したらPRを作成すること。use context 7.

----

とあるAIに考案されたキャラクター「双面の道化師」をもとにキャラクター設定を手直ししようと考えている。草案はファイルに添付した。

- 獲物からエネルギーを吸収する手段を考えている
  - 考えてる例：「脈動する肉壁にメリーゴーラウンドのように回される」「表裏の人格がそれぞれピンクと紫の胃液を出してねばねばにする」
- 獲物からエネルギーを吸い付くし、体内にしばらく閉じ込めるための手段を考えている
  - 考えてる例：「人形の姿に変えられ、もとに戻るまでおもちゃにされ続ける」

## 基本コンセプト
かわいいマスコットキャラクターのような見た目でありながら、「双面」という名の通り二面性を持つ不気味で危険なボス

## 外見設定

### 基本フォルム
- **身長**: 200cm程度、浮遊している
- **体型**: ふわふわした球状の胴体、短い手足
- **基本カラー**: パステルピンクとライトブルーのツートーン
- **装飾**: 金色の小さな鈴がついた帽子とマント

### 顔の特徴（重要な二面性）
- **表の顔**: 
  - 大きな丸い目、ピンクの頬、にっこり笑顔
  - 子供向けアニメのマスコット的な愛らしさ
  - 喋るときは高めの可愛い声
- **裏の顔**:
  - 同じ顔が逆さまになると、目が細く邪悪に、笑顔が不気味な三日月型に
  - リボンのような舌をちらちらと見せる
  - 色調も暗く変化（ピンク→深紅、ブルー→紫）
  - 喋るときは低く響く不気味な声

## 性格・行動パターン

### 表の顔の性格
- **無邪気**: 子供のように純粋で遊び好き
- **人懐っこい**: プレイヤーを「お友達」と呼んで親しみやすく接する
- **好奇心旺盛**: 「遊ぼう！」「一緒に楽しもう！」といった誘い文句
- **実は計算高い**: 可愛さで油断を誘う演技の面もある

### 裏の顔の性格
- **冷酷**: 感情を表に出さず、計算づくで行動
- **支配欲**: プレイヤーを「貴重なエネルギー源」として食べ、体内に閉じ込めようとする
- **完璧主義**: 自分の計画通りに事が運ばないと激昂
- **知性的**: 心理戦を得意とし、プレイヤーの弱点を突く

### 戦闘時のセリフ例
- **表**: 「わーい！新しいお友達だ〜♪ 一緒に遊ぼうよ〜！」
- **裏**: 「…フフフ、面白い玩具が来たな。存分に楽しませてもらおう」
- **変身時**: 「あれ？どっちが本当の僕かな〜？」「愚問だな…どちらも真実だ」

### 誕生の秘密
- かつて存在した遊園地のマスコットキャラクターが具象化された不思議な生命体
- 従業員からは得体の知れないスタッフと思われつつも存在を黙認され、子どもたちを楽しませていた
- 一方で生命エネルギーを得るために、迷子の子どもや、一人になったスタッフなどを密かに捕食していた
- 捕食した獲物はエネルギーを吸い尽くした後に開放する。本人にとっては恐ろしい体験を与えるが、周囲は誰も大事にしなかった
- しかし被害者が増えると遊園地への苦情が相次ぎ、最終的に遊園地は閉園してしまった
- 閉園後も遊園地の廃墟に住み着き、「遊び相手」を求めて徘徊している

### 捕食手段と体内
- **捕食方法**: 
  - 表の顔でプレイヤーを誘い込み、油断させた後に裏の顔で捕まえる
  - 捕まえた後は、表の顔で「遊び」と称して拘束し、裏の顔でリボンのような舌で捉え捕食する

### 生息地
- **場所**: 廃遊園地

----

沼のドラゴン勝利時・敗北時それぞれで解禁される「資料テキスト」を実装するために、そのテキストを作成したい。
なお、沼のドラゴンの設定は `docs/bosses/swamp-dragon.md` に記載されており、実際の実装 は `src/game/data/bosses/swamp-dragon.ts` に記載されている (実装ts側はセリフなどが若干古い設定のままなので注意) ので参照すること。

- 勝利時の資料テキスト
  - エルナルが書いた、沼のドラゴンに関するレポートの内容
  - 身体的な特徴、生態、獲物の捕まえ方、体内のことについての詳細な説明
  - 沼のドラゴンの生存能力がとても高く、実は料理もできるということも記載している
- 敗北時の資料テキスト
  - 沼のドラゴンの捕食の要素を隠れた場所で観察し続けている、変わった冒険者が書いたレポート内容
  - 普通のニンゲンは沼のドラゴンに捕食されるとすぐにエネルギーを吸いつくされ吐き出されるが、エルナルの場合は長い間体内に閉じ込められたままという記載をする
  - エルナルは想像以上に生命力が高いことを示唆するととも、単にエルナルが美味しいと感じやすいだけかもとも記載する

----

沼のドラゴン勝利時・敗北時それぞれで解禁される「資料テキスト」を実装するために、そのテキストを作成したい。
なお、沼のドラゴンの設定は `docs/bosses/swamp-dragon.md` に記載されており、実際の実装 は `src/game/data/bosses/swamp-dragon.ts` に記載されている (実装ts側はセリフなどが若干古い設定のままなので注意) ので参照すること。

- 勝利時の資料テキスト
  - エルナルが書いた、沼のドラゴンに関するレポートの内容
  - 身体的な特徴、生態、獲物の捕まえ方、体内のことについての詳細な説明
  - 沼のドラゴンの生存能力がとても高く、実は料理もできるということも記載している
- 敗北時の資料テキスト
  - 沼のドラゴンの捕食の要素を隠れた場所で観察し続けている、変わった冒険者が書いたレポート内容
  - 普通のニンゲンは沼のドラゴンに捕食されるとすぐにエネルギーを吸いつくされ吐き出されるが、エルナルの場合は長い間体内に閉じ込められたままという記載をする
  - エルナルは想像以上に生命力が高いことを示唆するととも、単にエルナルが美味しいと感じやすいだけかもとも記載する

----

闇のおばけ勝利時・敗北時それぞれで解禁される「資料テキスト」を実装するために、そのテキストを作成したい。
なお、闇のおばけの設定は `docs/bosses/dark-ghost.md` に記載されており、実際の実装 は `src/game/data/bosses/dark-ghost.ts` に記載されているので参照すること。

- 勝利時の資料テキスト
  - エルナルが書いた、闇のおばけに関するレポートの内容
  - 身体的な特徴、生態、獲物の捕まえ方、体内のことについての詳細な説明
  -食べられた後、体内で魂を抜かれるときは自分でも恐怖を感じたということ、すぐに抜け出せて安心したと記載している
- 敗北時の資料テキスト
　-闇のおばけの生息域付近で最終できる「闇のエッセンス」に関するレポート内容（執筆者はどこかの研究員）
  - 闇のエッセンスは、闇のおばけが体内で獲物から魂を引き抜いた後、体内に魂を閉じ込めておくための依代のようなもの（青い人魂のような見た目をしている）
  -引き抜いた魂から十分なエネルギーを搾り取った後、獲物の体ごと吐き出される。その際に魂はすぐに獲物の体に戻るため、闇のエッセンスは抜け殻となる
  -闇のエッセンスは魔法の材料として優秀で需要が高い
  -このエッセンスを採集するために、悪いニンゲンが偽の討伐依頼を出して、弱い冒険者を闇のおばけに食べさせているという噂があり、現在のクエスト制度に対する問題提起をしている
  
----

夢魔ちゃんがエルナルを負けさせて (finishMoveした後、isDefeat時行動を繰り返した後) しばらくの間夢の世界に閉じ込めた、という設定のもとで、夢魔ちゃんが書いた夢日記レポートのテキストを作ってほしい。
cc: @crazybudgie

- 夢魔ちゃんの設定参考用
  - 設定テキスト (重要): `docs/bosses/dream-demon.md`
  - 実装: `src/game/data/bosses/dream-demon.ts`
- エルナルの設定参考用
  - 設定テキスト: `https://tonbonotion01.notion.site/mycharacter-elnal`
- 夢日記テキストの保存先 (ゲームで読み込めるようにする想定)
  - `src/game/data/documents/`

作業が終わったらPRを出してね！

----

もう少し手直しして、まずはニコレムの表の姿を描いてほしい。
普段の立ち絵、正面図、横顔図、後ろ姿図を描いてほしい。

- 身長: 200cm程度
- 浮遊している
- 体型: ふわふわした球状の胴体、1頭身、短い手足
- 基本カラー: パステルピンクとライトブルーのツートーン
- 装飾: 金色の小さな鈴がついた帽子、赤色のマント
- 大きな丸い目、ピンクの頬、にっこり笑顔
- 子供向けアニメのマスコット的な愛らしさ

とある廃遊園地に「ニコレム」という、かつてマスコットキャラクターとして活躍していた道化師が現れた。その道化師が現れて以来、付近の旅人が行方不明になっては、その者とそっくりのぬいぐるみが発見されるようになった。以来、その奇妙な道化師は討伐対象として指定されている。あなたの任務はその道化師を討伐し、この現象に終止符を打つことだ。道化師の姿は球体状で、縦に分かれたパステルピンクとライトブルーの体色をもつ。金色の小さな鈴がついた帽子と赤色のマント、そして笑顔を表す仮面を身に着けている。非常に特徴的な姿なので、その道化師はすぐに見つかるだろう。だがその仮面の裏には何が隠されているかはわからない。討伐の際は十分に注意すること。

----

シチュエーションを大きく変えたため、 dualJesterEternalActions の中身を入れ替えたい。

- プレイヤーがぬいぐるみ化して、体内のおもちゃ箱に飛び込められた後、道化師がぬいぐるみ化したプレイヤーをおもちゃとして遊び続ける…という内容になる。
- 以下は行動案
  - 

----

dualJesterEternalActionsの「永遠の遊び相手」以外の行動を全体的に作り直したい。以下の設定をもとに、道化師の裏の人格が半永久的に主人公を甚振る行動を定義する。

- 基本的に表の人格は出さない
- ぬいぐるみ化した主人公に対して、道化師の裏の人格の姿は2～3倍大きい
- 行動例
  - きつく抱きしめる
  - リボンのような舌で激しく舐め回す
  - 主人公の体をくすぐりまわす
  - 主人公の体を振り回す

探検記録に「進行度」の表示を追加したい。

- 倒したボスの種類 x 10
- 負けたボスの種類 x 10
- 上昇したアビリティレベル x 2

をスコアとして、得られる最大のスコアと現在のスコアの割合を「進行度」として表示する。

天空の彼方から、巨大な天使のような存在が降り、その圧倒的な大きさで街を荒らしているそうだ。それは「救済」と称して、善意に満ちた瞳で人々を「救済」しているそうだが、被害は甚大である。あなたの任務はその天使のような存在を討伐し、街を救うことだ。

----

エクスプローラーレベル 8 のボス草案を出してほしい。既存ボスの実装を解析し、エクスプローラーレベル 8 のボスのデザイン方針を考える。

- エクスプローラーレベル 8 は「火山・灼熱地方」を生息地とする。
- 火山の熱や溶岩、もしくは機械をテーマにしたキャラクターであること。
- 拘束技や丸呑み攻撃、体内攻撃も考慮すること。

----

新しいボス「魔界の竜」を実装したい。以下の内容を参考にして、ボスの設定を固めてください。
他のボスの解析や、ボス作成ガイド `docs/boss-creation-guide.md` を確認して、実装方法を確認してください。

- エクスプローラーレベル 10
- 生息地: 魔界地方
- 体型: 真紫の体毛と蛇腹をもつ、四つ足で首の長い巨大なドラゴン
- 目に入る生き物をなんでも丸呑みにしてしまう
- 丸呑みした生き物は長い首を通って胴体の嗉嚢まで送られる
- 嗉嚢に送られた生き物は「魔の胃袋」と呼ばれる不定形の胃袋に取り込まれてしまう
- 魔の胃袋に取り込まれた生き物はもはや脱出できず、その生き物が感じる最も幸せな「体内保管プロセス」で閉じ込められ続ける
- 戦闘内容
  - 通常行動
    - 踏みつけ
    - 闇の魔法弾
    - 粘液発射
    - しっぽ拘束
    - しっぽ締め付け (拘束時のみ)
    - 舐め回し (拘束時のみ)
    - 体毛による吸収 (拘束時のみ)
    - 目を合わせて催眠術 (拘束時のみ)
    - 丸呑み (拘束中にダウンしたときのみ)
  - 通常時特殊行動
    - ソウルバキューム (通常時・拘束していないときのみ、1ターン目から即発動、その後30ターンごとに発動)
      - 口を大きく開け、あらゆる生きる魂を直接吸い込む
      - プレイヤーが即座に食べられ状態になる
  - 食べられ状態時
    - 食べられ継続5ターン目まで
      - 蠕動運動
        - 食道内で蠕動し、プレイヤーの最大HPをわずかに奪う
        - 1ターンごとに内部的に異なる行動とし、異なるメッセージを出す (少しずつ胴体へと送られる描写)
        - 5ターン目で「嗉嚢」に到着したというメッセージ＋次のターンに脱出できないと明らかに危険という警告
    - 食べられ継続6ターン目
      - 魔の胃袋取り込み
        - 不定形の触手が伸び、プレイヤーを魔の胃袋に取り込む
        - 即座に最大HPが0になり、敗北状態になる
  - 敗北状態 (魔の胃袋に取り込まれた)
    - 3つのパターンから1つ選ばれ異なる描写がある (10ターンごとにランダムで変化する。遷移時に共通のメッセージ)
      - 粘液付けの胃袋
        - 粘液で満たされた胃袋に閉じ込められ、プレイヤーはその粘液に包まれながら幸せな感覚に浸る
      - 触手詰めの胃袋
        - 触手がプレイヤーを包み込み、優しく揉みほぐしながら幸せな感覚に浸る
      - 圧縮胃袋
        - 胃袋の圧力でプレイヤーは包み込まれ、幸せな感覚に浸る

魔界の竜のHPは2600とします。
敗北状態時の3つのパターンでは、描写を行うための行動を4つほど定義してください。

実装前にブランチを作成すること。実装が終わったら一度コミットした後、コードレビューをAgentに依頼し、必要に応じて修正すること。終了したらPRを発行する。

目に入る生き物をなんでも丸呑みにしてしまう巨大なドラゴンをご存知だろうか。奴は彼方の魔に蝕まれた地方に住み、真紫の体毛と蛇腹をもつ、四つ足で首の長い竜だ。奴は目に写った生物を丸呑みにし、魔の胃袋と呼ばれる不定形の胃袋に取り込んでしまうという。奴の胃袋に取り込まれた生き物は、その生き物が感じる最も幸せな体内保管プロセスで閉じ込められ続けると言われている。もしお前が腕に自身のある冒険者なら、奴を討伐し、その胃袋の秘密を暴いてみてはどうだろうか。奴を討伐するためには、強力な武器と防具、そして十分な準備が必要だ。奴の胃袋に取り込まれないよう、注意深く戦うことを忘れないでほしい。

