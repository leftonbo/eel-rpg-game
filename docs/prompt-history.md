ブラウザで遊べるターン制RPGゲームを作りたい。

- 言語は typescript
- ゲームのジャンルはターン制RPG
- タイトル名は "Eel Feed"
- 主人公はウナギのようなキャラクターのエルナルで、巨大なボス敵を倒しに行く目的がある
- ゲームの初期画面はタイトル画面と、注意書きテキスト、スタートボタンがある
- スタートを押すと、どのボスと戦うか選ぶ画面が出る。ボスのボタンを選択すると簡易的な説明が出て、OKボタンを押すとバトル開始
  - ボスはとりあえず、沼のドラゴン、闇のおばけ、機械のクモの3種類を用意
  - 内部的にはそれぞれのボスに対してHPや攻撃力などのパラメーター、行動パターンを設定できる
- バトルはターン制で、攻撃や防御、アイテム使用などの選択肢がある
- バトル中は、エルナルのHPやボスのHPが画面に表示される
- エルナルのステータス
  - HP: 1000
  - 攻撃力: 20
  - アイテム: 回復薬9個（HPを50%回復＋状態異常解除）、アドレナリン注射3個（次のターンまで無敵になる）
- エルナルができる行動
  - 攻撃（通常攻撃）
  - 防御（次のターンのダメージを半減）
  - アイテム使用（ターンを消費しない）
- ボスの行動の例
  - 単純にダメージを与える攻撃
  - 状態異常攻撃（火だるま、毒、鈍足、魅了など）
  - 拘束攻撃 (後術)
- ボスの拘束攻撃を受けると、「拘束状態」になり、解除されるまでエルナルは「もがく」か「じっとする」しかできない
  - もがくを選ぶと確率で拘束解除できる。失敗するほど確率が増加
  - じっとするを選ぶと、次のターンまで拘束が続くが、HPがすこし回復する
- ボスのHPが0になると勝利してバトル終了、ボス選択画面に戻る
- エルナルのHPが0になってもバトルは終了しないが、エルナルは5ターン行動できなくなる (5ターン後にHPが50%回復する)
- エルナルのHPが0になった状態でボスの拘束を受けていると、ボスに食べられてしまい（食べられ状態）、エルナルは「もがく」か「じっとする」しかできない
  - 拘束状態と同様だが、食べられ状態が解除される可能性は低い
- ボスに食べられ状態では、毎ターンボスがエルナルの最大HPを吸収し続ける
  - これによって最大HPが0以下になったら、エルナルはボスの体内に閉じ込められたという旨が表示されてゲームオーバーとなり、ボス選択画面に戻る

----

HTMLのスタイルには bootstrap を使用したいです。

ボス敵のデータは、今後簡単に増やせるように、ボス1体ごとに1ファイルにしたいです。

また、git関連のファイルのセットアップもお願いします(.gitignore, .gitattributes)。

----

各設定を記載した README.md の生成もお願いします。

----

状態異常に関する追記です。

・火だるま：2ターンの間、HPが毎ターン80減少します
・魅了：5ターンの間、「もがく」の成功率が低下します
・鈍足：2ターンの間、エルナルの攻撃力が半減します

ボスに食べられたときにボスが行ってくるHP九州は、ボスからの攻撃力に依存するものとします。

----

以下の修正を入れたいです。

- HPの数値の桁数を減らしたいので、現在設定されている全てのHPと攻撃力の値を 1/10 にしたい。
- その上で、エルナルの攻撃力を 5 に増加したい。
- エルナルが戦闘不能になった場合、「☠なすがまま」の行動ボタンを追加して、ターンをスキップできるようにしたい。拘束状態のコマンドでも同様に追加する。
- ボスの拘束攻撃から逃れた後の、ボスの気絶ターンが1ターンだけになっている。気絶したターンを含め、3ターン気絶した状態にしてほしい。

各修正が終わるごとにgitにコミットしてほしいです。コミット文の先頭には gitmoji による絵文字をつけてください。

git コミット文は日本語で記載してください。

----

- 状態変化の継続ターンが、想定より1ターン短くなっているようです。状態変化のターン数経過が行動開始前になっているかもしれませんので、行動開始後に状態変化のターン数を減らすように修正してください。また、状態変化による影響や、変化終了時のメッセージを出してください。
- エルナルの行動不能が終了したときのHP回復が動作していないようです。
- エルナルが行動不能になっている場合、行動選択画面は「☠なすがまま」だけの表示にしてください。

----

行動不能の解除がターン終了時に行うようにしたため、行動不能解除の回復が動作しなくなってしまうようです。以下のように修正したいです。

- 状態変化のターン消費と、状態変化によるダメージ処理、行動不能解除後のHP回復を、全体のラウンド終了時 (プレイヤーとボス両方の行動が終わった後) に行うように修正してください。

----

現状でも、エルナルの行動不能が終了したときのHP回復が動作していないようです。

----

- ボスの拘束攻撃と、食べる攻撃を明確に分離したいです。
- 拘束中にエルナルが行動不能になったら、ボスは高い確率で食べる攻撃の行動をさせたいです。
- 通常状態でエルナルが行動不能になったら、ボスは高い確率で拘束攻撃、または直接食べる攻撃をさせたいです。

1作業が終わったらコミットしてください。コミットメッセージや、コメントは日本語でお願いします。

----

以下の改良をしたい
コミットメッセージは1行にまとめてください。

- HPは「ヘルス」という名称にしたい
- エルナルやボスが与えるダメージにプラスマイナス20%のゆらぎを持たせたい
- 攻撃が5％の確率でミスになり、5％の確率で攻撃力3倍のクリティカルヒットになるようにしたい
  - エルナルが行動不能になっている間、ボスの攻撃はミスにならない
- 将来的に名前変更しやすいよう、主人公の「エルナル」の名前を変数にしたい
- 回復薬の回復量を、50％から80％に変更したい

----

以下の要素を追加したいです

- エルナルに「マナ(MP)」を追加し、初期値は40とする
- マナは毎ターンの開始時に、最大値の 1/4 回復する
- エルナルの行動に、マナを消費する行動 (スキル) を追加
  - パワーアタック (20MP消費、2.5倍の攻撃力で攻撃、ミスしない)
  - ヒール (30MP消費、HPを100回復)
  - あばれる (拘束状態でのみ使用可能。30MP消費、拘束から脱出する確率が2倍、失敗した場合は次以降に脱出できる確率が大きく増加)
- マナが足りない状態でスキルを使うと、スキルの効果が2倍になるが、「疲れ果て」状態になる
  - 疲れ果て状態ではスキルを使うことができない
  - 疲れ果て状態では攻撃力が半減して、受けるダメージが1.5倍になる
  - MPが最大まで回復しきるか、4ターン経過すると疲れ果て状態は解除される
- アイテムを追加:「元気ドリンク」
  - 3ターンの間、MPが常に満タンになる
  - 3個所持
- ボスに食べられている間は、MPが回復せず、ボスにMPを吸収され続ける
  - これによって疲れ果て状態になることはない

----

プレイヤーが行動した後、ステータス表示画面を更新してほしいです

----

攻撃 (行動) のパラメーターに以下を追加したい。

- 攻撃の成功率の上書き (デフォルトは現在と同じ 95%)
- 攻撃のクリティカル率の上書き (デフォルトは現在と同じ 5%)
- 状態異常を与えるとき、その状態異常の発生率の指定 (デフォルトは 100%)
- (ボス用) 行動条件に、エルナルが指定した状態（通常・HP0・拘束・食べられ状態）であることを条件に追加できる

そのうえで、ボスの行動を以下のように改良したい。
- 沼のドラゴン
  - 「クロー攻撃」修正：エルナルが通常状態のときのみ使用する
  - 「噛みつき」修正：攻撃力を15に上げる代わりに、成功率を70%にする。エルナルが通常状態のときのみ使用する。
  - 「尻尾しめつけ」を追加：拘束状態のときのみ使用する。ダメージは8で、成功率は100%。(クロー攻撃の代わり)
  - 「べろちゅー」を追加：拘束状態のときのみ使用する。ダメージは12で、成功率は100%。(噛みつき攻撃の代わり)
  - 「体内締め付け」「体内マッサージ」「お腹ゆらし」を追加：食べられ状態のときのみ使用する。元々ある「消化」のメッセージを変えるのみで、ダメージは変わらない。
- 闇のおばけ
  - 「影の爪」修正：エルナルが通常状態のときのみ使用する
  - 「なめまわし」を追加：拘束状態のときのみ使用する。

----

ボス行動で、拘束中のみに使える行動が、通常時でも使おうとしてしまうようです。また、食べられ中に使う行動が、元々ある行動上書きに書き換えられてしまうようです。

----

エルナルにアップグレードシステムを追加したいです。

- バトル開始前の画面にて、エルナルのステータスとアビリティレベルを表示
- エルナルはいくつかのアビリティを持っており、バトル中の行動によってアビリティ経験値を得る。一定経験値を得るとアビリティレベルが上がり、効果が強化される
- 各アビリティのレベルは初期状態は0で、最大10まで上げられる。必要な総獲得経験値は [次のアビリティレベル] ^ 3 * 100 で計算される
- アビリティは以下の通り
  - コンバット
    - 1レベルごとに攻撃力が 2% 上昇 (レベル/50を掛け算。小数点はゆらぎなどを計算した後の最終ダメージ計算時に四捨五入)
    - 与えたダメージ 1 ごとに 1 経験値を得る
    - レベルが上がるとエルナルが装備できる武器を解禁する (バトル開始前の画面で装備を選択できる)
      - レベル 0: 素手 (攻撃力 5)
      - レベル 1: パチンコ (攻撃力 6)
      - レベル 2: 木の弓矢 (攻撃力 8)
      - レベル 4: コンパウンドボウ (攻撃力 10)
      - レベル 6: サブマシンガン (攻撃力 15)
      - レベル 8: レーザーライフル (攻撃力 20)
      - レベル 10: スーパーブラスター (攻撃力 30)
  - タフネス
    - 1レベルごとに最大ヘルスが 10% 上昇 (レベル/10を掛け算。四捨五入)
    - 受けたダメージ 1 ごとに 1 経験値を得る。
    - HP0になり戦闘不能になるとき、 50 経験値を得る。
    - レベルが上がるとエルナルが装備できる防具を解禁する (バトル開始前の画面で装備を選択できる)
      - レベル 0: はだか (+0 HP)
      - レベル 1: Tシャツ (+10 HP)
      - レベル 2: 旅装 (+20 HP)
      - レベル 4: 冒険者の服 (+50 HP)
      - レベル 6: 軍用ジャケット (+100 HP)
      - レベル 8: 近未来スーツ (+200 HP)
      - レベル 10: 超合金アーマー (+500 HP)
  - クラフトワーク
    - 1レベルごとにアイテムによるHP回復の効果が 10% 上昇 (レベル/10を掛け算。小数点は四捨五入)
    - レベルが上がることによって新しいアイテムが解禁されたり、所持数が増加したりする
      - レベル 0: 回復薬 (5個、以降１レベルごとに所持数+1)
      - レベル 1: 元気ドリンク (1個)
      - レベル 2: 手投げ爆弾 (1個。ターン消費せずにボスに攻撃力 50 のダメージを与える)
      - レベル 3: 元気ドリンク所持数 +1 (合計2個)
      - レベル 4: アドレナリン注射 (1個)
      - レベル 5: 元気ドリンク所持数 +1 (合計3個)
      - レベル 6: 手投げ爆弾所持数 +1 (合計2個)
      - レベル 7: エリクサー (1個。HPを100%回復し、状態異常を解除、元気ドリンクの効果を得る)
      - レベル 8: アドレナリン注射所持数 +1 (合計2個)
      - レベル 9: アドレナリン注射所持数 +1 (合計3個)
      - レベル 10: おまもり (1個。行動不能状態・拘束中・食べられ中にのみ使える。即座にそれらの状態を解除し、HPを100%回復し、状態異常を解除)
    - アイテムを使用するたびに 50 経験値を得る。(高レベルのアイテムは得られる経験値が増える)
  - エンデュランス
    - 1 レベルごとに MP の最大値が 10% 上昇 (レベル/10を掛け算。小数点は四捨五入)
    - MP 1 消費ごとに 3 経験値を得る。「疲れ果て」になると 50 経験値を得る。
  - 今後アビリティは増やす予定。内容は深く決まっていない (スキルを解禁する「マジック」や、拘束抜け出し率を上げる「アジリティ」など)
- これらのアップグレードシステムに対応するため、各ボスのヘルスと攻撃力を2倍にしたいです。

最初の画面は以下のようにしたいです。

- 現在のエルナルステータス表示: 詳細表示ボタンで詳細ステータス・装備切り替え画面へ
- ボス選択画面: 現在と同じようにボスのステータスと挑むボタンを表示

エルナルのレベルアップ処理とUI表示をバトル終了時に実施したいです。
また、このときに LocalStorage にエルナルのレベルや経験値を保存して、次回のゲーム開始時に読み込めるようにしたいです。

装備切り替え機能で装備を切り替えた場合、装備の変更を LocalStorage に保存して、次回のゲーム開始時に読み込めるようにしたいです。

----

- ボスにダメージを与えても、コンバットに経験値が入らないときがあるようです。
- バトル中に左下のボタンで中断したときも、レベルや経験値に変動があれば結果画面を表示したいです。
- バトルの勝敗が決まった時、画面が自動で遷移するのではなく、行動メニューに「バトル終了」ボタンを出し、
  それを押すことで結果画面に遷移するようにしたいです。

修正した作業ごとに git にコミットしてください。

修正1についてですが、経験値はバトル終了画面に遷移したときに反映させるようにしたいです。なお、ダメージを受けたときのタフネス経験値は現在即座に反映されているようです。


----

- 初期MPを40から50に変更したいです。
- 毎ターンのMPの回復量を、最大値の1/4から1/5に変更したいです。
- アドレナリンの効果時間を1ターンから3ターンにしたいです。
- アドレナリンの効果が「ダメージが0になる」になっていますが、「ボスの攻撃を全て回避する (ミス扱い)」に変更したいです。
- エルナルのHPが0になったときに「エルナルはダウンしてしまった！」というメッセージを出したいです。

修正した作業ごとに git にコミットしてください。

----

- 未解禁のアイテムは、アイテム選択画面に表示しないようにしてください。
- スキルやアイテムの選択画面で、項目の簡単な説明を表示したいです。

修正した作業ごとに git にコミットしてください。

----

- 沼のドラゴンの「べろちゅー」、闇のおばけの「なめあわし」でダメージを与えたとき、ボスのHPをその分だけ回復させたいです。
- 食べられ時の最大HP吸収時、ボスのHPや最大HPもその分上がるようにしたいです（その戦闘中だけ有効）

将来的な拡張を踏まえて、与えたダメージに対するHP吸収量を指定できるようにしたいです。(デフォルトは0.0(無効)、1.0でダメージと同じ量回復)

----

- 攻撃時のダメージのゆらぎを、±20％をデフォルトとして、行動ごとに設定できるようにしたい。
  - スキルの「パワーアタック」は-20%～+50%のゆらぎ
  - 沼のドラゴンの噛みつきは-50％～+50％のゆらぎ
- 食べられ中のボスのHP吸収攻撃にも、他の攻撃と同じようにダメージのゆらぎを設定できるようにしたい。

----

「エルナルのステータス」「ボスのステータス」「バトルログ」「行動選択」の色が濃すぎて、文字が背景に埋もれてしまうので直したい。bootstrapのカラーテーマをそのまま使うより、自前のカラー定義で表示させたい。

また、CSSが黒ベースなのに対して、bootstrapのテーマカラーがライトのままになっているように思われるので、ダークテーマのbootstrapに固定させたい。

----

まず先に、バトルログの表示を改良したい。

- バトルログにて、誰の行動によるものかわかりやすくするようにしたい。
  - エルナルの行動は右にマージンをつけてウィンドウが左に寄るようし、ボスの行動は左にマージンをつけてウィンドウが右に寄るようにする
- 一部ボス行動に特殊なダイアログを表示させたい
  - 特に拘束攻撃や、拘束中・食べられ中攻撃に対して付けたい
  - 例：「沼のドラゴンは尻尾を巻き付けてきた！」「闇のおばけはエルナルの体を舐め回してきた！」など
  
次の作業で、ボスに食べられている状態で、エルナルの最大 HP が 0 以下になると即座にゲームオーバーになるが、これを少し変更したい。

- エルナルの最大 HP が 0 以下になるとすぐにゲームオーバーになるのではなく「再起不能」状態になり、詰みであることを示す
  - エルナルは「☠なすがまま」の行動しかできない (バトル終了まで自動的にターンが進む)
- 「再起不能」状態のエルナルに対してボスがトドメの攻撃を行ってから、ゲームオーバーにする
  - トドメの攻撃は「再起不能」状態のエルナルに対してのみ行う、実質的なゲームオーバーシーケンス
  - その内容は各ボスを深堀りするときに改めて決めたいので、一旦は仕組みだけ用意したい
  - トドメの攻撃が複数の連続的な行動で構成できるようにしたい。その場合、最後の行動を終えた後にゲームオーバーにする。
  - 特殊なダイアログを出せるようにしたい

作業ごとに git に日本語でコミットしてください。複数行にわたるコミットメッセージは、1行目に要約を記載し、2行目以降に詳細を記載してください。また、シングルクォーテーションで囲むようにしてください。

----

沼のドラゴンをより個性的なボスにしたい。

- 食べられ中の攻撃の1つ「消化」を「胃液分泌」にする
  - メッセージは「沼のドラゴンの胃袋が<PLAYER_NANE>をネバネバな胃液まみれにする...」
  - 他の行動となり、エルナルを3ターン「粘液まみれ」にする
    - 拘束状態の解除確率が半減する
- エルナルが「再起不能」になったときの行動を定義
  - 「沼のドラゴンは力尽きた<PLAYER_NAME>を体内の奥深くに送り込む！」
  - 「<PLAYER_NAME>は体内に閉じ込められ、沼のドラゴンが満足するまで消化され続けることになった...」
  - 以上のメッセージが出てゲームオーバーになる

作業ごとに git に日本語でコミットしてください。

----

戦闘終了後、エルナルの最大HPや状態異常が戻らないまま次のバトルに進んでしまうことがある。
戦闘終了時にこれらのステータスをリセットするようにしたい。

----

ボスの機械グモをより個性的なボスにしたい。

- 設定は「眼の前の生き物をなんでも壊れた機械と見なして修理しようとする機械クモ」
  - エルナルを「壊れた機械」と見なして、拘束して修理しようとする
  - エルナルを動けなくした後、繭に閉じ込めて縮小液で体を小さくしてから、体内修理装置で「修理」しようとする (でもエルナルは機械ではないので意味のない修理をされ続けることになる)
- ボスの行動
  - 「レーザーショット」通常時のみ使用。通常攻撃
  - 「クモキック」通常時のみ使用。ダメージが大きいが、成功率が低い攻撃
  - 「ショックバイト」通常時・対象ダウン中に使用、対象に噛みついて電気ショックを与える
    - 成功率が低い、当たると時々1ターンスタンさせる
  - 「スパイダーグラブ」通常時・対象ダウン中に使用、対象を抱きしめるように拘束する攻撃
    - 通常ダメージ、時々拘束状態にする
  - 「スパイダーネット」通常時・対象ダウン中に使用、機械の合成糸で作った網で対象を拘束する
    - ダメージはないが、高い確率で拘束状態にする
- エルナルが行動不能になり、拘束状態になったときに「縮小プロセス」を使用
  - エルナルを合成糸でぐるぐる巻きにして繭にし、内部を縮小液で満たす攻撃
  - 特別な拘束状態「繭状態」にする。
  - 拘束状態時と同じように、もがく、じっとするなどができ、拘束解除時に機械グモが行動不能になる
  - 繭状態時のクモの行動によって、エルナルの最大HPが減少する (エルナルの体が縮小されていることを表現)
    - 「繭の抱擁」: (通常行動)繭状態のエルナルをゆらゆら揺らし、最大HPを減らす
    - 「繭の圧縮」: 繭状態のエルナルを抱きしめて縮小液を馴染ませ、最大HPを多めに減らす
    - 「縮小液循環」：繭内部の縮小液を循環させることでエルナルのエネルギーを得る。最大HPを減らし、その2倍の量だけHPと最大HPを増やす。
  - 再起不能時の行動
    - 再起不能になった瞬間のメッセージ
      - 「エルナルは繭の中で完全に小さくなってしまった」
    - 機械グモが連続的に順番に以下の行動をする
      - 「機械グモは繭に噛みつき、中身をエルナルごと吸い上げる！」→エルナルが「食べられ」状態になる
      - 「機械グモは体内のエルナルを合成糸で体を拘束し、体内修理装置に縛りつける！」
      - 「修理装置に縛り付けられたエルナルは、機械グモが満足するまで意味のない修理をされ続ける....」→ゲームオーバー

作業ごとに git に日本語でコミットしてください。

----

github pages で公開するための設定を追加したいです。
その他、検索エンジンにインデックスされないように、METAタグと robots.txt を追加したいです。

ボス追加ドキュメントに以下の内容を追加で入れておきたい

- フレーバー設定などの注意点
  - エルナルに対する直接的で致命的な表現は控えるようにする (バラバラにしたり、死亡させたりはしない)

----

Player と Boss の共通処理部分をまとめた基底クラス Actor を作りたい。

- 共通化したい値
  - 表示名
  - HP
  - MP
  - ステータス値
    - 最大HP
    - 最大MP
    - 攻撃力
    - 防御力 (現在は0扱い)
- 共通化したい処理
  - ステータス値の再計算 ( `recalculateStats` )
    - Player はアビリティなどによるステータス再計算
    - Boss は識別IDからデータ参照によるステータス設定
  - 戦闘ステータスクリア処理 ( `resetBattleState` )
  - ダメージ処理 ( `takeDamage` )
    - HP の減少とダウン (KonckedOut) 処理
  - 回復処理 ( `heal` )
  - MP回復・消費処理
  - 戦闘ターン開始 ( `startTurn()` ) ・終了処理
  - 戦闘ラウンド終了処理 ( `processRoundEnd()` )

以上の計画で良さそうなので実装を進めよう

----

状態異常のコードが長くなってきたので整理したい。

- `configs` の記述が非常に長くなってしまったので、状態異常1つごとに情報を纏められるようにしたい。必要に応じてファイル分割を検討。
- `isXXX()` をステートごとに記載すると冗長なので、重要なステータスの `Dead` `Doomed` `KonckedOut` `Exhausted` `Restrained` `Eaten` 以外は、 `hasEffect` 関数で取得させるようにしたい。

----

沼のドラゴンのパーソナリティを考えてゲームに反映させたい。

- エルナルとくらべて3-4倍大きい、焦げ茶色のドラゴン
- カタコトで喋ることがあるが、基本的に言葉は少なく、それ以外は鳴き声や唸り声などを発する
- 狩猟など野性的な生活をしているが、文明のある生命体に対しては紳士で冷静な性格を見せる

----

エルナルが負けてしまった後 (ボスのとどめ行動をした後) も 「☠なすがまま」 でターンを進められるようにしたい。

- エルナルが食べられ、負けてしまった後の末路を観察しつづけられるというもの
- `isDead` とあるがシステム便宜上のもので、実際に死んだわけではないので注意
- 「☠なすがまま」の行動メッセージは「......」になる
- 各ボスはエルナルが負けてしまった (isDead = true) 後の特殊行動を BossAction で定義できる。4-5パターンあると良い
  - 各ボスの行動イメージ
    - 沼のドラゴン: 深い体内で体力を吸われ続けたり、消化活動を受け続ける
    - 闇のおばけ: 魂だけになったエルナルからエネルギーを吸い続ける
    - 機械グモ: 体内の修理装置に縛り付けたエルナルに対して栄養剤を注入したり、マッサージをしたり、無意味な修理をしたりする
    - 夢魔ちゃん: 夢の中で丸呑みしてとろとろになったエルナルを愛でつづける
  - これらの行動でエルナルの HP や MP は変動しないが、状態異常は与えても良い

----

新しいボス「砂漠のヘビ」を実装したい。

- 設定は「砂漠に生息する巨大なヘビ」
- 砂漠で彷徨った生命体を何でも飲み込んで、消化しながら遠くに連れ去ってしまう
- エルナルが拘束状態のとき、拘束中が3ターン続くと、エルナルがまだ倒れてなくても丸呑みしてくる
- 丸呑みされた後は、ヘビの体内に閉じ込められ、ヘビの消化液に浸される
  - 毎ターンの最大HP吸収は他のボスに比べ少ない
- その他ヘビっぽい能力があれば

実装できたらPR作って

----

新しいボス「運び屋のサソリ」を実装したい。

- 設定は「砂漠や荒れ地を漂う巨大なサソリ」
  - 見た目の特徴は、足がタイヤになっていて、巨大な注射器のような尻尾を持つ、半機械のような見た目をしている
  - さまよう人間を様々な方法で捕まえては丸呑みし、その者が望む (と勝手に考える) 場所へと運ぶ
  - 尻尾の注射器は色々な薬剤を注入するためのもので、麻酔や毒、栄養剤などを注入できる
  - 体内に閉じ込めた者は、サソリの体内で消化されることはないが、エネルギーやマナを吸収され続ける
  - 体内にも薬剤注入のための注射器があり、エネルギーやマナを吸収するための薬剤を注入してくる
- パーソナライズ
  - 「んー、迷い人のようだな？」
  - 「おまえの足より、オレの足のほうが早いぞ？」
  - 「恥ずかしがらずに食べられろ」
  - 「薬を打たれた気分はどうだ？」
- ボスの行動
  - 通常時
    - 「はさみ攻撃」通常攻撃
    - 「踏みつけ」通常攻撃
    - 「しっぽ振り回し」通常攻撃、命中率低いがダメージ大
    - 「しっぽ麻酔」命中率は低いが、エルナルを麻酔状態にする
      - 麻酔状態では行動できない
      - 3ターン後に麻酔が切れる
    - 「はさみキャッチ」エルナルを拘束状態にする、たまにミスする
    - 「猛毒注射」拘束状態のときのみ使用、ダメージとともにエルナルにサソリ毒状態を付与する
      - サソリ毒状態では毎ターン最大HPの1/10のダメージを受ける
      - 3ターン後に解除される
    - 「かみつき舐め回し」拘束状態のときのみ使用、ダメージを与える
  - エルナルがダウン時
    - 「大胆に丸呑み」食べられ状態遷移
  - 食べられ状態時
    - 「脱力剤注入」体内注射でエルナルに脱力剤を注入する
      - HPダメージが通常よりも1.5倍になる
      - 3ターン後に解除される
    - 「体内マッサージ」最大HPを吸収する
    - 「体内締め付け」最大HPを吸収する

実装できたらPR作って

----

新しいボス「蜜柑ドラゴン」を実装したい。

- 蜜柑の皮のような鱗と羽をもち、蜜柑の中身のようなお腹を持つドラゴン
- 体内の胃袋は蜜柑の汁のような粘液で満たされており、エルナルを体内に取り込んで培養、同族化させようとする
- 通常攻撃
  - 「蜜柑の爪」通常攻撃
  - 「蜜柑の尻尾」通常攻撃
- 蜜柑のような甘い香りを漂わせ、エルナルを誘い込む (「魅了」のデバフを受ける)
  - HP が減っているほど、蜜柑の香りに誘われやすくなる
- 蜜柑の汁のような粘液を出し、エルナルをネバネバにして攻撃力を下げる
- 長い舌をエルナルに巻き付けて拘束しようとする
- 拘束中の攻撃
  - 「蜜柑しぼり」巻き付けてる舌でエルナルの体を締める、通常のHPダメージ
  - 「蜜柑のキス」エルナルの体をまるごと加えて吸い尽くす、HP吸収攻撃
  - 「蜜柑汁注入」チューブ状の舌をエルナルの口に入れて蜜柑の汁を注入する。エルナルが「魅了」になる
- エルナルがダウン時
  - 「蜜柑の丸呑み」食べられ状態遷移
- 食べられ状態時
  - 「蜜柑汁注入」チューブ状の体内触手をエルナルの口に入れて蜜柑の汁を注入する。エルナルの最大HPを減らしながら「魅了」になる
  - 「蜜柑マッサージ」蜜柑の果肉のような胃壁でエルナルをマッサージし、最大HPを減らす
  - 「蜜柑触手くすぐり」体内触手をエルナルの体に巻き付けてくすぐり、最大HPを減らしながら「脱力」状態にする
- エルナルが「再起不能」になったときの行動
  - エルナルの体がみるみると蜜柑ドラゴンの幼体のような姿になる
  - 体内触手で蜜柑汁を注入され続け、培養されつづける

----

スキルをアンロック式にしたい。

- コンバット
  - レベル3: 「パワーアタック」スキル解禁
  - レベル5: 「パワーアタック」の威力 +50%
  - レベル7: 「パワーアタック」のクリティカル率 +20%
  - レベル9: 「ウルトラスマッシュ」スキルの解禁 (MPを全て消費。攻撃力+消費したMPのダメージを与える。クリティカル率+50%。使用後は疲れ果てになる)
- タフネス
  - レベル1: 「防御」コマンド解禁
  - レベル3: 拘束時の「じっとする」コマンド解禁
  - レベル5: 毎ターン、HPが最大HPの1/20だけ回復する (四捨五入、最低1)
  - レベル7: 「防御」中のHPダメージを100%カットする
  - レベル9: 拘束や食べられなどから抜け出すと、失った最大HPの50%を回復する
- エンデュランス
  - レベル3: 「防御」または「じっとする」コマンド時、MPが全回復するようになる
- アジリティ
  - レベル3: 拘束時の「あばれる」コマンド解禁
  - レベル5: 「あばれる」時、脱出の成否に関わらずボスにダメージを与える (攻撃力 x 1.5)

すでにある「ヒール」は一旦廃止とする。

----

セーブデータのインポート・エクスポート、削除をするためのメニューを、ボス選択画面のところに追加したい。
また、デバッグモード時に、エルナルのレベルや経験値を変更できるようにしたい。

---

プレイヤーの最大HPが減少すると、HPバーもそれに合わせて短くなるという描写を入れたい

最大HPが初期状態より増えることがあるので、その場合はHPがはみ出さないように従来通りの描写としたいです。
また、最大HPが減少した場合、バー本体も短くなる描写にしたいです。

----

新しいボス「海のクラーケン」を作りたい。

- 紫色の体と触手をもつ巨大イカ
- 深海に生息するがたまに海岸に現れ生き物をなんでも飲み込む
- 触手の吸盤や、体内にある無数の吸盤は強力な吸引力を持ち、獲物を捉えるだけでなくエネルギーを吸収できる
- 体や触腕の先から吐き出すイカスミは視界を奪うだけでなく、飲み込んでしまうと催眠効果がある
- 通常の行動
  - 「触手ビンタ」通常攻撃
  - 「叩きつけ」ちょっと威力が高いが命中率が低い攻撃
  - 「イカスミブレス」前方にイカスミを吐き出し、視界を奪う (3ターンの間、攻撃の命中率を下げる)
  - 「触腕巻き付け」拘束攻撃
  - 「触腕吸引」拘束状態のときのみ使用可能。捉えた獲物を吸盤で吸引し、エネルギーを吸収する。HP吸収攻撃
  - 「イカスミ注入」拘束状態のときのみ使用可能。触腕を捉えた獲物の口に入れてイカスミを注入し、魅了状態にさせる
- 主人公(エルナル)がダウン＋拘束時
  - 捉えた獲物を触腕ごと口に押し込み獲物を飲み込む
- 食べられ状態時
  - 「胃袋吸盤吸引」体内の獲物のエネルギーを、胃袋にある無数の吸盤で吸収する。威力の高い最大HP吸収攻撃
  - 「体内イカスミ漬け」体内の獲物をイカスミ漬けにする。最大Hpを吸収しながら魅了状態にさせる
- 主人公(エルナル)が「再起不能」になったときの行動
  - エルナルはイカスミを注入されがら吸盤で吸収されるのを永遠に繰り返され、
    クラーケンの体内でエネルギーを吸収され続けることになる

実装が終わったらブランチ切ってPR出してください

----

(変になったのでやめた)

攻撃やスキルなどの処理を共通化するために `Action` クラスを作成したい。まずはクラスの内容だけを定義する。

- `Action` クラスは以下のプロパティを持つ
  - `name`: スキル名
  - `description`: スキルの説明
  - `target`: 対象 (自分自身か、敵か)
  - `mpCost`: マナ消費量
  - `message`: 行動時のメッセージ (リストで複数行のメッセージを指定可能)
    - メッセージはフォーマット指定可能 (例: `<USER>は<TARGET>に<ACTION>を使った！`)
  - `repeatCount`: 繰り返し回数 (通常は1。2以上で「命中判定→ダメージ→特殊効果」の処理を繰り返す) 省略時は 1
  - `accuracy`: 成功率 (0.0 - 1.0) 。失敗時はダメージや特殊効果は発生しない
  - `accuracyType`: 成功率計算タイプ (`fixed`:固定、 または `evade`: 使用者の命中補正と対象の回避率を参照)
  - `damageParameter`: ダメージ計算パラメータ
    - `targetStatus`: ダメージの対象 (HP, MP, 最大HP, 最大MP)
    - `type`: ダメージのタイプ (ダメージ、回復、吸収)
    - `formula`: ダメージ計算式 (例: `20` `a.attack * 2.5` `a.attack * 0.5 - b.attack * 0.5`)
    - `fluctuation`: ダメージのゆらぎ係数 (デフォルトは0.2)
    - `criticalRate`: クリティカル率 (デフォルトは0)
  - `extraEffects`: 対象に発生する追加効果のリスト (複数かつ異なるタイプの効果を指定可能)
    - ステート (状態異常) の付与
      - `state`: ステートの種類
      - `probability`: 発生率 (0.0 - 1.0)
      - `duration`: 継続ターン数、省略時はステートのデフォルト継続ターン数
      - `value`: 効果値 (例: 毒の毎ターンダメージ量など)、省略時はステートのデフォルト値
    - ステートの解除
      - `state`: 解除するステートの種類
      - `probability`: 解除の成功率 (0.0 - 1.0)
    - 任意実行
      - `function`: 実行する関数 (引数は使用者と対象)
- 通常攻撃用に、上記を用いて `SkillNormalAttack` クラスを作成。想定されるパラメータは以下の通り
  - name: "通常攻撃"
  - description: "通常攻撃"
  - target: 'enemy'
  - mpCost: 0
  - message: ["<USER>の攻撃！"]
  - accuracy: 1.0
  - accuracyType: 'evade'
  - damageParameter: 
    - targetStatus: 'hp'
    - type: 'damage'
    - formula: "a.attack" (ラムダ式で指定？)
    - fluctuation: 0.2
    - criticalRate: 0.05
  - extraEffects: []
- 1回分の行動結果を表すクラス `ActionResult` を作成
  - `success`: 行動が成功したかどうか
  - `hpChange`: HPの変化量 (正の値は回復、負の値はダメージ)
  - `mpChange`: MPの変化量 (正の値は回復、負の値はダメージ)
  - `addStates`: 追加されたステートのリスト
  - `removeStates`: 解除されたステートのリスト

Action はあくまで行動結果を計算するためのパラメータを定義するものとしたいです。
現在の実装にあるような、ボスの行動条件などは Action の外側で定義します。

Action.ts の内容を少し改変しました。

次に、Actionと使用者のActor、対象のActorを引数にとって、行動結果 `ActionResult` を計算する `ActionExecutor` クラスを作成します。

----

新しいボスについて考えたい。今考えているのは以下の通り。

- 大海原を泳ぐヘビ型の龍
- 青い体をもち、体内が淡く光っていてお腹が透けて見える
- 体内の光は獲物からエネルギーを吸収することで強くなる
- 海にさまよう生命体を飲み込み、長い体を通過させながらエネルギーを吸収する習性をもつ
- 見つけた獲物に対して口から水のブレスを吐いたり、長い体を叩きつけたりして攻撃。その長い体で拘束することも
- 長い体で獲物を拘束したら、体で締めたり、獲物を咥えてキスをしたりして体力を奪い、弱らせてから丸呑みにする
- 体内に閉じ込められた獲物は、体内の光に照らされながら長い体内を通過させられる。お腹が透けているので、外からお腹の獲物が見えたり、中から海の様子が見えたりする
- 体内の獲物を津波のような胃液で洗いながらさらに獲物を弱らせ、吸収効率を高める
- 尻尾まで運ばれた獲物は普通は近くの海岸に吐き出されるが、まだエネルギーが足りないと感じると、再び飲み込んでしまう。

以下の方針で実装を進めましょう。作業ブランチ切った後に作業して、作業ごとにコミットしてください。全て終わったらPRを作成してください。
use context 7.

# 海の龍「アクアサーペント」

- 基本攻撃技
  - 水圧ブレス
    - 口から高圧水流を発射
    - 中威力の水属性攻撃
    - 低確率で「水浸し」状態異常（防御力ダウン）
  - 津波の一撃
    - 尻尾で水を巻き上げて叩きつける
    - 高威力の物理攻撃
    - 水しぶきでプレイヤーの視界を遮る
  - 渦潮スラム
    - 長い体をうねらせて全身で攻撃
    - 中威力、命中率やや低め
    - ヒット時に「目眩」状態異常
- 必殺技 (通常時)
  - 深海の審判
    - HP30%以下で使用、使用後クールダウン20ターン
    - 海水を操り巨大な水の檻を作成
    - 大ダメージ + 高確率で拘束状態
- 拘束・特殊技
  - 海蛇の抱擁
    - 長い体でプレイヤーを巻き付け拘束
    - 拘束状態に移行
  - 深海のキス
    - 拘束中のみ使用可能
    - プレイヤーの体ごとキスして体力とMPを吸収
  - 丸呑み
    - 拘束中にプレイヤーのHPが0になると使用
    -「食べられ」状態に移行、体内に閉じ込められる
- 体内技（食べられ状態中）
  - 胃液の嵐
    - 体内で津波のような胃液を放出
    - 最大HPを吸収
  - 蠕動運動
    - 体内の壁が収縮してプレイヤーを押し流す
    - 最大HPを吸収
  - 体内発光
    - 体内の光が強くなりプレイヤーを幻惑
    - 「魅了」状態異常
  - 生命吸収の渦
    - 体内にいるプレイヤーから大量の生命力を吸収
    - 大ダメージ + 吸収
    - 使用後は一定確率でプレイヤーを吐き出す (食べられ解除)
- 再起不能時の行動
  - 「アクアサーペントの体内で力尽きた<プレイヤー名>は、蠕動運動によってさらに体内への奥へと引きずられていく…」
- 再起不能行動後の、ボス無限体内行動
  - 「胃液でゆっくり体を洗われる」「激しい蠕動運動でさらに奥へ」「マッサージされながら、透けた体内から外の深海を眺める」「体内で渦を起こされてぐるぐる目にされる」などといったメッセージがランダムで表示される
  - 10ターンごとに尻尾から出され、そのまま口から再捕食される描写が発生
    

透明腹部
体内のプレイヤーが外の海の様子を見られる演出
戦闘には直接影響しないが、没入感を高める
「透明な腹部越しに海の光が見える...」

----

このボス作成ガイドの情報は古くなっているので、現在の実装と異なるものがあれば修正したい。クラーケンやアクアサーペントあたりが新しい方の実装になっているのでそれらも参考に。

----

デバッグモード時、バトル画面にデバッグボタンを追加し、そのボタンからデバッグ機能のある画面に飛べるようにしたい。

- プレイヤー・ボスのHP/MP、StatusEffectの詳細閲覧・編集。
- ボスの Custom Variables の状態閲覧・編集。

use context 7. 作業ブランチを先に作って。作業ごとにコミットしてください。

デバッグ画面をシーンの1つとして追加しましたが、以下の問題点があるようです。

- BattleScene が破棄されてしまうため、デバッグ画面から戻った際にバトルの最初からになってしまう。

以下のように修正していきたいです。

- デバッグ画面はバトル画面の上に Model で重ねて出すようにして、デバッグシーンは使わないようにしたい (バトル前画面の主人公ステータス詳細画面のように。)
- デバッグ画面を開く時、HP・MPは現在値が入っている状態にしたい。

BossSelectScene でも isDebugMode があり、個別でデバッグモードを判定している。GameクラスのisDebugMode()と統合したい。

また、 npm run dev 時、 `?debug=true` が付いた状態でブラウザが開くようにしたい。

----

UI改善したい所を列挙します。作業ブランチで実装し、作業ごとにコミットすること。
use context 7.

- BossSelectScene で使っている showMessage を bootstrap による toast を使った通知にしたい。またどのシーンでも使えるように汎用化したい。
  - bootstrap toasts: https://getbootstrap.jp/docs/5.3/components/toasts/
  - デバッグ画面にて `alert()` を使っている所を、上記の toast でメッセージを出せるようにしたい。
- デバッグ画面やセーブデータ消去画面で `prompt()` や `confirm()` を使っているが古いブラウザの機能である。 bootstrap によるUIに差し替えたい。ただし modal は一度に1つしか使えないはずなので別の方法または工夫して実装する必要がありそう。

----

いくつかの修正をしたい。
「「悪夢の投影」という精神攻撃に対して毒状態異常は概念的に不整合です。混乱や恐怖など、精神的な効果により適した状態異常の使用を検討してください。」というCopilotのツッコミを受けて、闇のおばけの食べられ時行動を改良したい。また専用の状態異常を追加したいです。

- 「恐怖の注入」は他のスキルとの差別化が難しいため削除
- 通常の食べられ時攻撃のバリエーションに1つ追加
  - 「魂の引き抜き」体内にいる獲物の魂を影の触手で引き抜こうとする
- 「絶望の囁き」「恐怖の注入」で「恐怖」状態を与えるようにする
  - 状態異常「恐怖」を追加
    - 効果: 被ダメージが 1.5 倍
    - 継続ターン数: 3ターン
- 「記憶の侵食」で「忘却」状態を与えるようにする
  - この攻撃は20ターンのクールダウンを設定 (ハメ防止)
  - 状態異常「忘却」を追加
    - 効果: スキル使用不可
    - 継続ターン数: 3ターン

作業ごとにコミットしてください。全て終わったらプッシュ。 use context 7.

----

仮タイトルを「Eel Feed」としていたが、そろそろちゃんとしたタイトルを決めたい。

もともとはウナギのキャラ（Eel）が餌を与える（餌になる）（Feed)という意味合いだが、これに合わせてエルナル（Elnal）が餌になる（Feeds)という意味で「Elnal Feeds」というタイトルが一つの案。
これに「The Elnal Feeds」といったものを後ろに付けて「ElnalFTX」というタイトルにするのも考えたが、XXXにあたる単語が浮かばなかったので保留にしている。
もしよければ、XXXにあてはめる単語や、もっと別のタイトル案があれば、列挙してほしい。

----

エルナルに新しいアビリティ「エクスプローラー」を追加したい。

- フレーバーは「エルナルがボスとの戦いを通じて得た経験で、探検できる範囲が広まる」という意味
- エクスプローラーレベルを挙げると、新しいボスとの戦闘がアンロックされる。
  - 最初、ボスは「沼のドラゴン」「闇のおばけ」「機械のクモ」としか戦えない
  - レベルを上げるごとにボスがアンロックされていく (これは BossData に記載できるようにする。ボス作成ガイドもこれに合わせて更新したい)
    - レベル1: 運び屋のサソリ (砂漠関係のボス)
    - レベル2: クラーケン、アクアサーペント (海関係のボス)
    - レベル3: 夢魔ちゃん (ゲストキャラ関係)
    - レベル4: 蜜柑ドラゴン (ジャングル関係のボス)
    - レベル5: (洞窟・地下世界関係のボス、今は誰も居ない)
    - レベル6: クリーンマスター (遺跡・廃墟関係のボス)
    - レベル7: (氷河・雪山関係のボス、今は誰も居ない)
    - レベル8: (火山・溶岩関係のボス、今は誰も居ない)
    - レベル9: (天空・宇宙関係のボス、今は誰も居ない)
    - レベル10: (魔界・冥界関係のボス、今は誰も居ない)
  - エクスプローラー経験値を上げる手段
    - ボスを初めて倒すと得られる記念品 (経験値は解禁レベルに応じて変化)
      - 経験値 = (そのボスの解禁レベル + 1) ^ 2 * 100
      - 例: 沼のドラゴンを倒すと「沼のドラゴンのたてがみ」を入手し、エクスプローラー経験値を100得る
    - ボスに初めて負ける (とどめ攻撃を受ける) と得られる記念品 (経験値は解禁レベルに応じて変化)
      - 経験値 = (そのボスの解禁レベル + 1) ^ 2 * 100
      - 例: 沼のドラゴンに負けると「沼のような粘液」を入手し、エクスプローラー経験値を100得る
    - 1回の戦闘でボスから受けたスキルの種類に応じて経験値を得る
      - 管理複雑化を防ぐため、単に受けたスキル名の数をカウント。受けたスキル数 * 20 * (そのボスの解禁レベル + 1) の経験値を得る

実装はブランチ上で行う。作業ごとにコミットしてください。 use context 7.

- 「エクスプローラー」アビリティをエルナルのアビリティ一覧にも表示させたい。
- 未解禁のボスは選択できないのではなく、非表示としたい。

- バトル中、左下のボス選択に戻るを押すと、まだ負けていないのに負け扱いになってしまうので、初回負け記念品を受け取った扱いになる。負けていないときは「中断した」ということにしたい。
- 記念品を受け取ったことや、エクスプローラーのレベルアップによるボス開放をバトル結果画面に表示したい。

Trophy を内部データ用とセーブデータ用に分離したい。

- 内部データ用
  - BossData に持たせるデータを想定 (ボスごとにテキストを定義できる。勝利時・敗北時の2つ)
    - 記念品名
    - 記念品の説明
- セーブデータ用
  - 獲得したトロフィーID
  - 獲得した日時

ボスの解禁レベル分布の説明で、地域ごとにレベル分けしていることを明記したい。

- レベル1: 砂漠
- レベル2: 海
- レベル3: ゲストキャラ関係
- レベル4: ジャングル
- レベル5: 洞窟・地下世界
- レベル6: 遺跡・廃墟
- レベル7: 氷河・雪山
- レベル8: 火山・溶岩
- レベル9: 天空・宇宙
- レベル10: 魔界・冥界 (理不尽度 MAX!)

新ボス設定ガイドに、勝利時記念・敗北時記念に関する記載を入れたい。勝利時の記念品は「ボスの外側から採れるアイテム」、敗北時の記念品は「ボスの体内から採れるアイテム」とする。
「新ボスファイルの作成」における項目において、 BossData を参考に記念品データの実装方法について記載すること。


エルナル詳細画面の探検タブで、現在のエクスプローラーレベルでどこの地形に行けるかというフレーバーなテキストを追加したい。

- レベル0: 近隣の地方
- レベル1: 砂漠
- レベル2: 海
- レベル3: (ゲストキャラ関係、表示はしない)
- レベル4: ジャングル
- レベル5: 洞窟
- レベル6: 遺跡・廃墟（２つ表示）
- レベル7: 寒冷地
- レベル8: 火山
- レベル9: 天空
- レベル10: 魔界
