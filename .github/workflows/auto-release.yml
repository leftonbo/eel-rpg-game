name: Auto Release on Tag Push

on:
  push:
    tags:
      # release/v „ÅßÂßã„Åæ„Çã„Çø„Ç∞„ÅÆ„Åø„Å´„Éû„ÉÉ„ÉÅ (‰æã: release/v1.0.0, release/v0.1.0)
      - 'release/v*'

# GITHUB_TOKEN„ÅÆÊ®©ÈôêË®≠ÂÆö
permissions:
  contents: write  # „É™„É™„Éº„Çπ‰ΩúÊàê„Å´ÂøÖË¶Å

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        # ÂÆåÂÖ®„Å™Â±•Ê≠¥„ÇíÂèñÂæó„Åó„Å¶„É™„É™„Éº„Çπ„Éé„Éº„ÉàÁîüÊàê„ÇíÊîπÂñÑ
        fetch-depth: 0
    
    - name: Extract version from tag
      id: extract-version
      run: |
        # „Çø„Ç∞Âêç„Åã„Çâ release/ „Éó„É¨„Éï„Ç£„ÉÉ„ÇØ„Çπ„ÇíÂâäÈô§
        # ‰æã: release/v1.0.0 ‚Üí v1.0.0
        VERSION=${GITHUB_REF#refs/tags/release/}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "Extracted version: $VERSION"
    
    - name: Check if release already exists
      id: check-release
      run: |
        # Âêå„Åò„Çø„Ç∞„ÅÆ„É™„É™„Éº„Çπ„ÅåÊó¢„Å´Â≠òÂú®„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        if gh release view "${{ steps.extract-version.outputs.version }}" > /dev/null 2>&1; then
          echo "exists=true" >> $GITHUB_OUTPUT
          echo "Release ${{ steps.extract-version.outputs.version }} already exists"
        else
          echo "exists=false" >> $GITHUB_OUTPUT
          echo "Release ${{ steps.extract-version.outputs.version }} does not exist"
        fi
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Create GitHub Release
      if: steps.check-release.outputs.exists == 'false'
      run: |
        gh release create "${{ steps.extract-version.outputs.version }}" \
          --title "Release ${{ steps.extract-version.outputs.version }}" \
          --generate-notes \
          --latest
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Release creation completed
      if: steps.check-release.outputs.exists == 'false'
      run: |
        echo "‚úÖ GitHub Release ${{ steps.extract-version.outputs.version }} has been created successfully!"
        echo "üöÄ The deploy workflow will be triggered automatically."
    
    - name: Release already exists
      if: steps.check-release.outputs.exists == 'true'
      run: |
        echo "‚ÑπÔ∏è Release ${{ steps.extract-version.outputs.version }} already exists. Skipping creation."